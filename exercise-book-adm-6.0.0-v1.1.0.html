<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<title>Apache KafkaÂ® Administration by Confluent: Exercise Book</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Apache KafkaÂ® Administration by Confluent: Exercise Book</h1>
<div class="details">
<span id="revnumber">version 6.0.0-v1.1.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_copyright_trademarks">Copyright &amp; Trademarks</a></li>
<li><a href="#_lab_02_fundamentals_of_apache_kafka">Lab 02 Fundamentals of Apache Kafka</a>
<ul class="sectlevel2">
<li><a href="#_a_introduction">a. Introduction</a></li>
<li><a href="#_b_using_kafkas_command_line_tools">b. Using Kafkaâs Command-Line Tools</a></li>
<li><a href="#_c_producing_records_with_a_null_key">c. Producing Records with a Null Key</a></li>
</ul>
</li>
<li><a href="#_lab_03_providing_durability">Lab 03 Providing Durability</a>
<ul class="sectlevel2">
<li><a href="#_a_investigating_the_distributed_log">a. Investigating the Distributed Log</a></li>
</ul>
</li>
<li><a href="#_lab_04_managing_a_kafka_cluster">Lab 04 Managing a Kafka Cluster</a>
<ul class="sectlevel2">
<li><a href="#_a_exploring_configuration">a. Exploring Configuration</a></li>
<li><a href="#_b_increasing_replication_factor">b. Increasing Replication Factor</a></li>
<li><a href="#_c_kafka_administrative_tools">c. Kafka Administrative Tools</a></li>
</ul>
</li>
<li><a href="#_lab_05_optimizing_kafkas_performance">Lab 05 Optimizing Kafka&#8217;s Performance</a>
<ul class="sectlevel2">
<li><a href="#_a_exploring_producer_performance">a. Exploring Producer Performance</a></li>
<li><a href="#_b_modifying_partitions_and_viewing_offsets">b. Modifying Partitions and Viewing Offsets</a></li>
<li><a href="#_c_performance_tuning">c. Performance Tuning</a></li>
</ul>
</li>
<li><a href="#_lab_06_kafka_security">Lab 06 Kafka Security</a>
<ul class="sectlevel2">
<li><a href="#_a_securing_the_kafka_cluster">a. Securing the Kafka Cluster</a></li>
</ul>
</li>
<li><a href="#_lab_07_data_pipelines_with_kafka_connect">Lab 07 Data Pipelines with Kafka Connect</a>
<ul class="sectlevel2">
<li><a href="#_a_running_kafka_connect">a. Running Kafka Connect</a></li>
</ul>
</li>
<li><a href="#appendix-reassign-partitions">Appendix A: Reassigning Partitions in a Topic - Alternate Method</a></li>
<li><a href="#docker-local">Appendix B: Running Labs in Docker for Desktop</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_copyright_trademarks">Copyright &amp; Trademarks</h2>
<div class="sectionbody">
<div class="paragraph">
<p> <br>
 <br>
 <br>
 <br></p>
</div>
<div class="paragraph text-center">
<p>Copyright Â© Confluent, Inc. 2014-2021. <a href="https://www.confluent.io/confluent-privacy-statement/">Privacy Policy</a> | <a href="https://www.confluent.io/terms-of-use/">Terms &amp; Conditions</a>.<br>
Apache, Apache Kafka, Kafka and the Kafka logo are trademarks of the<br>
<a href="http://www.apache.org/">Apache Software Foundation</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_02_fundamentals_of_apache_kafka">Lab 02 Fundamentals of Apache Kafka</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_introduction">a. Introduction</h3>
<div class="paragraph">
<p>This document provides Hands-On Exercises for the course <strong>Apache KafkaÂ® Administration by Confluent</strong>. You will use a setup that includes a virtual machine (VM) configured as a Docker host to demonstrate the distributed nature of Apache Kafka.</p>
</div>
<div class="paragraph">
<p>The main Kafka cluster includes the following components, each running in a Docker container:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/fundamentals/kafka-cluster.png" alt="kafka cluster">
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 1. Components of the Confluent Platform</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hostname</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zk-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZooKeeper 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zk-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZooKeeper 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zk-3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZooKeeper 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Broker 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Broker 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka-3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Broker 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema-registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema Registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ksqlDB-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ksqlDB Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">control-center</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confluent Control Center</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A container used to run tools against the cluster</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you progress though the exercises you will selectively turn on parts of your cluster as they are needed.</p>
</div>
<div class="paragraph">
<p>You will use Confluent Control Center to monitor the main Kafka cluster. To achieve this, we are also running the Control Center service which is backed by the same Kafka cluster.</p>
</div>
<div class="paragraph">
<p>In this course we are using Confluent Platform version 6.0.0 which includes Kafka 2.6.0.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In production, Control Center should be deployed with its own dedicated Kafka cluster, separate from the cluster with production traffic. Using a dedicated metrics cluster is more resilient because it continues to provide system health monitoring even if the production traffic cluster experiences issues.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_alternative_lab_environments">Alternative Lab Environments</h4>
<div class="paragraph">
<p>As an alternative you can also download the VM to your laptop and run it in VirtualBox. Make sure you have the newest version of VirtualBox installed. Download the VM from this link:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://confluent-training-images-us-east-1.s3.amazonaws.com/training-ubuntu-18-04-may2020.ova">https://confluent-training-images-us-east-1.s3.amazonaws.com/training-ubuntu-18-04-may2020.ova</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have installed Docker for Desktop on your Mac or Windows 10 Pro machine, then you can run the labs there. But please note that your trainer might not be able to troubleshoot any potential problems if you are running the labs locally.  If you choose to do this, follow the instructions at &#8594; <a href="#docker-local">Running Labs in Docker for Desktop</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_command_line_examples">Command Line Examples</h4>
<div class="paragraph">
<p>Most Exercises contain commands that must be run from the command line. These commands will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>pwd</strong>
/home/training</pre>
</div>
</div>
<div class="paragraph">
<p>Commands you should type are shown in bold; non-bold text is an example of the output produced as a result of the command.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_continued_learning_after_class">Continued Learning After Class</h4>
<div class="paragraph">
<p>Once the course ends, the VM in Content Raven will terminate and you will no longer have access to it. However, you can still download the VM onto your own machine or use Docker locally to revisit these materials. We encourage you to bring up your own test environment, explore configuration files, inspect scripts, and perform tests. Here are some activities we encourage to reinforce your learning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Revisit the exercises in this exercise book</p>
</li>
<li>
<p>Summarize and discuss the student handbook with your peers</p>
</li>
<li>
<p>Consult the README in this course&#8217;s public source repository: <a href="https://github.com/confluentinc/training-operations-src">https://github.com/confluentinc/training-operations-src</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="preparing-lab">Preparing the Lab</h4>
<div class="paragraph">
<p>Welcome to your lab environment! You are connected as user <strong>training</strong>, password <strong>training</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you haven&#8217;t already done so, you should open the <strong>Exercise Guide</strong> that is located on the lab virtual machine. To do so, open the <strong>Confluent Training Exercises</strong> folder that is located on the lab virtual machine desktop. Then double-click the shortcut that is in the folder to open the <strong>Exercise Guide</strong>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/fundamentals/local-exercise-guide.png" alt="local exercise guide">
</div>
</div>
<div class="paragraph">
<p>Copy and paste works best if you copy from the Exercise Guide on your lab virtual machine.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standard Ubuntu keyboard shortcuts will work: <code>Ctrl+C</code> &#8594; Copy, <code>Ctrl+V</code> &#8594; Paste</p>
</li>
<li>
<p>In a Terminal window: <code>Ctrl+Shift+C</code> &#8594; Copy, <code>Ctrl+Shift+V</code> &#8594; Paste.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you find these keyboard shortcuts are not working you can use the right-click context menu for copy and paste.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a terminal window</p>
</li>
<li>
<p>Clone the source code repository to the folder <code>confluent-admin</code> in your <strong>home</strong> directory and change to that directory:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~</strong>
$ <strong>git clone --branch 6.0.0-v1.1.0 \
    https://github.com/confluentinc/training-administration-src.git \
    confluent-admin</strong></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you chose to select another folder for the labs then note that many of our samples assume that the lab folder is <code>~/confluent-admin</code>. You will have to adjust all those commands to fit your specific environment.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Navigate to the <code>confluent-admin</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong></pre>
</div>
</div>
</li>
<li>
<p>Start the complete Kafka cluster with the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose up -d</strong>
Creating network "confluent-admin_confluent" with the default driver
Creating volume "confluent-admin_data-zk-log-1" with default driver
Creating volume "confluent-admin_data-zk-data-1" with default driver
Creating volume "confluent-admin_data-zk-log-2" with default driver
Creating volume "confluent-admin_data-zk-data-2" with default driver
Creating volume "confluent-admin_data-zk-log-3" with default driver
Creating volume "confluent-admin_data-zk-data-3" with default driver
Creating volume "confluent-admin_data-kafka-1" with default driver
Creating volume "confluent-admin_data-kafka-2" with default driver
Creating volume "confluent-admin_data-kafka-3" with default driver
Creating zk-2            ... done
Creating schema-registry ... done
Creating connect         ... done
Creating tools           ... done
Creating kafka-2         ... done
Creating kafka-1         ... done
Creating ksqldb-server   ... done
Creating zk-1            ... done
Creating zk-3            ... done
Creating kafka-3         ... done
Creating control-center  ... done</pre>
</div>
</div>
</li>
<li>
<p>Monitor the cluster with:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose ps</strong>
     Name                  Command               State                               Ports
-------------------------------------------------------------------------------------------------------------------
connect           /etc/confluent/docker/run   Up (healthy)   0.0.0.0:8083-&gt;8083/tcp, 9092/tcp
control-center    /etc/confluent/docker/run   Up             0.0.0.0:9021-&gt;9021/tcp
kafka-1           /etc/confluent/docker/run   Up             0.0.0.0:19092-&gt;19092/tcp, 9092/tcp
kafka-2           /etc/confluent/docker/run   Up             0.0.0.0:29092-&gt;29092/tcp, 9092/tcp
kafka-3           /etc/confluent/docker/run   Up             0.0.0.0:39092-&gt;39092/tcp, 9092/tcp
ksqldb-server     /etc/confluent/docker/run   Up (healthy)   0.0.0.0:8088-&gt;8088/tcp
schema-registry   /etc/confluent/docker/run   Up             0.0.0.0:8081-&gt;8081/tcp
tools             /bin/bash                   Up
zk-1              /etc/confluent/docker/run   Up             0.0.0.0:12181-&gt;12181/tcp, 2181/tcp, 2888/tcp, 3888/tcp
zk-2              /etc/confluent/docker/run   Up             2181/tcp, 0.0.0.0:22181-&gt;22181/tcp, 2888/tcp, 3888/tcp
zk-3              /etc/confluent/docker/run   Up             2181/tcp, 2888/tcp, 0.0.0.0:32181-&gt;32181/tcp, 3888/tcp</pre>
</div>
</div>
<div class="paragraph">
<p>All services should have <code>State</code> equal to <code>Up</code>.</p>
</div>
</li>
<li>
<p>OPTIONAL: You can also observe the stats of Docker on your VM:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker stats</strong>

CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %    ...
23a0817edf17        kafka-3             51.45%              450.4MiB / 9.758GiB   4.51%    ...
2133c07a5909        control-center      42.19%              443.5MiB / 9.758GiB   4.44%    ...
632188f5590d        zk-3                0.09%               88.41MiB / 9.758GiB   0.88%    ...
ad213dd14b53        ksqldb-server       0.56%               252.8MiB / 9.758GiB   2.53%    ...
87cc691bc971        zk-1                0.09%               88.86MiB / 9.758GiB   0.89%    ...
71709f3da755        kafka-1             6.27%               458.8MiB / 9.758GiB   4.59%    ...
da2fe67720c1        tools               0.00%               1.273MiB / 9.758GiB   0.01%    ...
b9852c134792        kafka-2             35.25%              446.7MiB / 9.758GiB   4.47%    ...
842fa80a9c2f        connect             0.80%               1.629GiB / 9.758GiB   16.70%   ...
c04a39218779        schema-registry     0.31%               180.4MiB / 9.758GiB   1.81%    ...
fe51891d9ae5        zk-2                0.09%               92.99MiB / 9.758GiB   0.93%    ...</pre>
</div>
</div>
<div class="paragraph">
<p>Press Ctrl+C to exit Docker stats.</p>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_testing_the_installation">Testing the Installation</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>zookeeper-shell</code> command to verify that all Brokers have registered with ZooKeeper. You should see the three Brokers listed as <code>[101, 102, 103]</code> in the last line of the output.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>zookeeper-shell zk-1:12181 ls /brokers/ids</strong>
Connecting to zk-1:12181


WATCHER::

WatchedEvent state:SyncConnected type:None path:null
[101, 102, 103]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For those <strong>not</strong> using the VM but instead are using Docker for Desktop, remember to run commands against the cluster from within the <code>tools</code> container with <code>docker-compose exec tools bash</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_optional_analyzing_the_docker_compose_file"><strong>OPTIONAL:</strong> Analyzing the Docker Compose File</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the file <code>docker-compose.yml</code> in your editor and:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>locate the various services that are listed in the table earlier in this section</p>
</li>
<li>
<p>note that the <code>hostname</code> (e.g. <code>zk-1</code> or <code>kafka-2</code>) is used to resolve a particular service</p>
</li>
<li>
<p>note how each ZooKeeper instance (zk-1, zk-2, zk-3)</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>gets a unique ID assigned via environment variable <code>ZOOKEEPER_SERVER_ID</code></p>
</li>
<li>
<p>gets the information about all members of the ensemble:</p>
<div class="listingblock">
<div class="content">
<pre>ZOOKEEPER_SERVERS=zk-1:2888:3888;zk-2:2888:3888;zk-3:2888:3888</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>note how each Broker (kafka-1, kafka-2, kafka-3)</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>gets a unique ID assigned via environment variable <code>KAFKA_BROKER_ID</code></p>
</li>
<li>
<p>defines where to find the ZooKeeper instances</p>
<div class="listingblock">
<div class="content">
<pre>KAFKA_ZOOKEEPER_CONNECT: zk-1:12181,zk-2:22181,zk-3:32181</pre>
</div>
</div>
</li>
<li>
<p>configures the Broker to send metrics to Control Center:</p>
<div class="listingblock">
<div class="content">
<pre>KAFKA_METRIC_REPORTERS: "io.confluent.metrics.reporter.ConfluentMetricsReporter"
CONFLUENT_METRICS_REPORTER_BOOTSTRAP_SERVERS: "kafka-1:9092,kafka-2:9092,kafka-3:9092"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>note how various services use the environment variable <code>&#8230;&#8203;_BOOTSTRAP_SERVERS</code> to define the list of Kafka Brokers that serve as bootstrap servers:</p>
<div class="listingblock">
<div class="content">
<pre>..._BOOTSTRAP_SERVERS: kafka-1:9092,kafka-2:9092,kafka-3:9092</pre>
</div>
</div>
</li>
<li>
<p>note how e.g. the <code>connect</code> service and the <code>ksql-server</code> service define Producer and Consumer interceptors that produce data which can be monitored in Control Center:</p>
<div class="listingblock">
<div class="content">
<pre>io.confluent.monitoring.clients.interceptor.MonitoringProducerInterceptor
io.confluent.monitoring.clients.interceptor.MonitoringConsumerInterceptor</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_control_center">Using Control Center</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the VM, open a new browser tab in Google Chrome.</p>
</li>
<li>
<p>Navigate to Control Center at <a href="http://localhost:9021" target="_blank" rel="noopener">http://localhost:9021</a>:</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/fundamentals/control-center.png" alt="control center">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Control Center environment will take a few minutes to stabilize and report a healthy cluster.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the cluster <strong>Cluster 1</strong> and you will see this:</p>
<div class="imageblock">
<div class="content">
<img src="./images/fundamentals/c3-cluster-overview.png" alt="c3 cluster overview">
</div>
</div>
</li>
<li>
<p>Click on <strong>Brokers</strong> on the left to go to the <strong>Brokers overview</strong> page.</p>
<div class="imageblock">
<div class="content">
<img src="./images/fundamentals/c3-brokers-overview.png" alt="c3 brokers overview">
</div>
</div>
</li>
<li>
<p>In the <strong>Brokers overview</strong> page, click on <strong>Production</strong> to open the <strong>Metrics</strong> page.</p>
</li>
<li>
<p>Click on the button that shows the current date, and change <code>Last 4 hours</code> to <code>Last 30 minutes</code>.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/fundamentals/c3-time.png" alt="c3 time">
</div>
</div>
</li>
<li>
<p>In the <strong>Production</strong> section of the <strong>Metrics</strong> page, you are looking at metrics for <strong>Produce</strong> requests in your cluster. Hover your mouse over the <strong>Throughput</strong> and <strong>Request latency</strong> graphs.</p>
<div class="paragraph">
<p><strong>Consumption</strong> metrics are visible either to the right of or below the <strong>Production</strong> metrics depending upon the Control Center window width. This section of the <strong>Metrics</strong> page displays similar metrics for <strong>Consume</strong> requests.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In production, Control Center should be deployed with its own dedicated Kafka cluster, separate from the cluster with production traffic. Using a dedicated metrics cluster is more resilient because it continues to provide system health monitoring even if the production traffic cluster experiences issues.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute the following command to completely cleanup your environment:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose down -v</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_b_using_kafkas_command_line_tools">b. Using Kafkaâs Command-Line Tools</h3>
<div class="paragraph">
<p>In this Hands-On Exercise you will start to become familiar with some of Kafkaâs command-line tools. Specifically you will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a tool to <strong>create</strong> a Topic</p>
</li>
<li>
<p>Use a console program to <strong>produce</strong> a message</p>
</li>
<li>
<p>Use a console program to <strong>consume</strong> a message</p>
</li>
<li>
<p>Use a tool to explore data stored in ZooKeeper</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_prerequisites">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <code>confluent-admin</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong></pre>
</div>
</div>
</li>
<li>
<p>Run the Kafka cluster, including Control Center:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_console_producing_and_consuming">Console Producing and Consuming</h4>
<div class="paragraph">
<p>Kafka has built-in command line utilities to produce messages to a Topic and read messages from a Topic. These are extremely useful to verify that Kafka is working correctly, and for testing and debugging.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before we can start writing data to a Topic in Kafka, we need to first create that Topic using a tool called <code>kafka-topics</code>. From within the terminal window run the command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This will bring up a list of parameters that the <code>kafka-topics</code> program can receive. Take a moment to look through the options.</p>
</div>
</li>
<li>
<p>Now execute the following command to create the Topic <code>testing</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics --bootstrap-server kafka-1:19092 \
    --create \
    --partitions 1 \
    --replication-factor 1 \
    --topic testing</strong></pre>
</div>
</div>
<div class="paragraph">
<p>We create the Topic with a single Partition and <code>replication-factor</code> of one.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>auto.create.topics.enable</code> was set to <code>true</code> and the previous step had not been completed, the Topic would automatically be created when the first record is written to it using the default topic number of partitions and default replication factor. Enabling auto topic creation is <strong>strongly discouraged</strong> in production. Always create your Topics explicitly!
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now let&#8217;s move on to start writing data into the Topic just created. From within the terminal window run the command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This will bring up a list of parameters that the <code>kafka-console-producer</code> program can receive. Take a moment to look through the options. We will discuss many of their meanings later in the course.</p>
</div>
</li>
<li>
<p>Run <code>kafka-console-producer</code> again with the required arguments:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer --bootstrap-server kafka-1:19092 --topic testing</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The tool prompts you with a <code>&gt;</code>.</p>
</div>
</li>
<li>
<p>At this prompt type:</p>
<div class="listingblock">
<div class="content">
<pre>&gt; <strong>some data</strong></pre>
</div>
</div>
<div class="paragraph">
<p>And hit <strong>Enter</strong>.</p>
</div>
</li>
<li>
<p>Now type:</p>
<div class="listingblock">
<div class="content">
<pre>&gt; <strong>more data</strong></pre>
</div>
</div>
<div class="paragraph">
<p>And hit <strong>Enter</strong>.</p>
</div>
</li>
<li>
<p>Type:</p>
<div class="listingblock">
<div class="content">
<pre>&gt; <strong>final data</strong></pre>
</div>
</div>
<div class="paragraph">
<p>And hit <strong>Enter</strong>.</p>
</div>
</li>
<li>
<p>Press <code>Ctrl+D</code> to exit the <code>kafka-console-producer</code> program.</p>
</li>
<li>
<p>Now we will use a Consumer to retrieve the data that was produced. Run the command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This will bring up a list of parameters that the <code>kafka-console-consumer</code> can receive. Take a moment to look through the options.</p>
</div>
</li>
<li>
<p>Run <code>kafka-console-consumer</code> again with the following arguments:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server kafka-1:19092 \
    --from-beginning \
    --topic testing</strong></pre>
</div>
</div>
<div class="paragraph">
<p>After a short moment you should see all the messages that you produced using <code>kafka-console-producer</code> earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some data
more data
final data</pre>
</div>
</div>
</li>
<li>
<p>Press <code>Ctrl+C</code> to exit <code>kafka-console-consumer</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_optional_running_producer_and_consumer_in_parallel">OPTIONAL: Running Producer and Consumer in Parallel</h4>
<div class="paragraph">
<p>The <code>kafka-console-producer</code> and <code>kafka-console-consumer</code> programs can be run at the same time. Run <code>kafka-console-producer</code> and <code>kafka-console-consumer</code> in separate terminal windows at the same time to see how <code>kafka-console-consumer</code> receives the events.</p>
</div>
</div>
<div class="sect3">
<h4 id="_optional_working_with_record_keys">OPTIONAL: Working with record keys</h4>
<div class="paragraph">
<p>By default, <code>kafka-console-producer</code> and <code>kafka-console-consumer</code> assume null keys. They can also be run with appropriate arguments to write and read keys as well as values.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Re-run the Producer with additional arguments to write (key,value) pairs to the Topic:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer \
    --bootstrap-server kafka-1:19092 \
    --topic testing \
    --property parse.key=true \
    --property key.separator=,</strong></pre>
</div>
</div>
</li>
<li>
<p>Enter a few values such as:</p>
<div class="listingblock">
<div class="content">
<pre>&gt; <strong>1,my first record</strong>
&gt; <strong>2,another record</strong>
&gt; <strong>3,Kafka is cool</strong></pre>
</div>
</div>
</li>
<li>
<p>Press <code>Ctrl+D</code> to exit the producer.</p>
</li>
<li>
<p>Now run the <strong>Consumer</strong> with additional arguments to print the key as well as the value:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server kafka-1:19092 \
    --from-beginning \
    --topic testing \
    --property print.key=true</strong>

null	some data
null	more data
null	final data
1	my first record
2	another record
3	Kafka is cool</pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>NULL</code> values for the first 3 records that we entered earlier&#8230;&#8203;</p>
</div>
</li>
<li>
<p>Press <code>Ctrl+C</code> to exit the Consumer.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_the_zookeeper_shell">The ZooKeeper Shell</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access Kafka&#8217;s data in ZooKeeper by using the <code>zookeeper-shell</code> command to connect to the ZooKeeper host <code>zk-1</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>zookeeper-shell zk-1:12181</strong>
Connecting to zookeeper
Welcome to ZooKeeper!
JLine support is disabled

WATCHER::

WatchedEvent state:SyncConnected type:None path:null</pre>
</div>
</div>
</li>
<li>
<p>From within the <code>zookeeper-shell</code> application, type <code>ls /</code> to view the directory structure in ZooKeeper. Note the <code>/</code> is required.</p>
<div class="listingblock">
<div class="content">
<pre><strong>ls /</strong>
[admin, brokers, cluster, config, consumers, controller, controller_epoch, isr_change_notification, latest_producer_id_block, log_dir_event_notification, zookeeper]</pre>
</div>
</div>
</li>
<li>
<p>Type <code>ls /brokers</code> to see this next level of the directory structure.</p>
<div class="listingblock">
<div class="content">
<pre><strong>ls /brokers</strong>
[ids, seqid, topics]</pre>
</div>
</div>
</li>
<li>
<p>Type <code>ls /brokers/ids</code> to see the broker ids for the Kafka cluster.</p>
<div class="listingblock">
<div class="content">
<pre><strong>ls /brokers/ids</strong>
[101,102,103]</pre>
</div>
</div>
<div class="paragraph">
<p>Note the last output <code>[101, 102, 103]</code>, indicating that we have 3 Brokers with IDs <code>101</code>, <code>102</code>, <code>103</code> in our cluster.</p>
</div>
</li>
<li>
<p>Type <code>get /brokers/ids/101</code> to see the metadata for broker 101.</p>
<div class="listingblock">
<div class="content">
<pre><strong>get /brokers/ids/101</strong>
{"listener_security_protocol_map":{"DOCKER":"PLAINTEXT","HOST":"PLAINTEXT"},"endpoints":["DOCKER://kafka-1:9092","HOST://kafka-1:19092"],"jmx_port":-1,"port":9092,"host":"kafka-1","version":4,"timestamp":"1602909525108"}</pre>
</div>
</div>
</li>
<li>
<p>Type <code>get /brokers/topics/testing/partitions/0/state</code> to see the metadata for partition 0 of topic <code>testing</code>.</p>
<div class="listingblock">
<div class="content">
<pre><strong>get /brokers/topics/testing/partitions/0/state</strong>
{"controller_epoch":1,"leader":103,"version":1,"leader_epoch":0,"isr":[103]}</pre>
</div>
</div>
<div class="paragraph">
<p>Note: During client startup, it requests cluster metadata from a broker in the <code>bootstrap.servers</code> list. The output of the two previous commands reflects a bit of this cluster metadata included in the broker response.</p>
</div>
</li>
<li>
<p>Press <code>Ctrl+D</code> to exit the ZooKeeper shell.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_2">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute the following command to completely cleanup your environment:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose down -v</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">Conclusion</h4>
<div class="paragraph">
<p>In this lab you have used Kafka command line tools to create a Topic, write and read from this Topic. Finally you have used the ZooKeeper shell tool to access data stored within ZooKeeper.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_c_producing_records_with_a_null_key">c. Producing Records with a Null Key</h3>
<div class="paragraph">
<p>In this Hands-On Exercise, you will create a Topic with <strong>multiple Partitions</strong>, produce records with a <code>null</code> key to those Partitions using the default partitioner, and then read it back to observe issues with ordering.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_2">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Start the Kafka cluster:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_produce_to_multiple_partitions">Produce to multiple Partitions</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From within the terminal window create a Topic manually with Kafkaâs command-line tool, specifying that it should have <strong>two Partitions</strong>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic two-p-topic \
    --partitions 2 \
    --replication-factor 1</strong></pre>
</div>
</div>
</li>
<li>
<p>You can use the <code>kafka-topics</code> tool to describe the details of the topic:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --describe \
    --topic two-p-topic</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Which will result in this output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Topic: two-p-topic	PartitionCount: 2	ReplicationFactor: 1	Configs: segment.bytes=536870912,retention.bytes=536870912
	Topic: two-p-topic	Partition: 0	Leader: 101	Replicas: 101	Isr: 101	Offline:
	Topic: two-p-topic	Partition: 1	Leader: 103	Replicas: 103	Isr: 103	Offline:</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Your Partitions might be placed on different Brokers.</p>
</li>
<li>
<p>The command output when using <code>--describe</code> includes configuration settings that are different from Kafka defaults.</p>
<div class="ulist">
<ul>
<li>
<p>The custom settings for <code>segment.bytes</code> and <code>retention.bytes</code> were set on the Lab environment Kafka brokers to limit the amount of message data that is retained and prevent disk full errors from occurring.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the command-line Producer to write several lines of data to the Topic.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>seq 1 20 &gt; numlist &amp;&amp;
  kafka-console-producer \
    --bootstrap-server kafka-1:19092 \
	--sync \
    --topic two-p-topic &lt; numlist</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>--sync</code> option causes the producer to send messages to brokers synchronously, one at a time as they arrive. Using <code>--sync</code> in this exercise will result in a better illustration of how the default partitioner assigns records to a partition when they have a <code>null</code> key.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the command-line Consumer to read the messages written to partitions <code>0</code> and <code>1</code>. Press <code>Ctrl+C</code> to exit the Consumer.</p>
<table class="tableblock frame-none grid-none] stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server \
        kafka-1:19092 \
    --from-beginning \
	--partition 0 \
    --topic two-p-topic</strong>
2
4
6
8
10
12
14
16
18
20</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server \
        kafka-1:19092 \
    --from-beginning \
	--partition 1 \
    --topic two-p-topic</strong>
1
3
5
7
9
11
13
15
17
19</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Note the order of the numbers. What do you think is happening as each message is being produced?</p>
</li>
<li>
<p>Using the previous steps as a guide, create a new Topic with three Partitions, produce the same records into that Topic, and then consume each of the three partitions.</p>
<div class="paragraph">
<p>You should see results similar to the following when you consume the three partitions:</p>
</div>
<table class="tableblock frame-none grid-none] stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server \
        kafka-1:19092 \
    --from-beginning \
	--partition 0 \
    --topic three-p-topic</strong>
5
7
10
13
16
18</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server \
        kafka-1:19092 \
    --from-beginning \
	--partition 1 \
    --topic three-p-topic</strong>
1
3
8
12
15
19</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server \
        kafka-1:19092 \
    --from-beginning \
	--partition 2 \
    --topic three-p-topic</strong>
2
4
6
9
11
14
17
20</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When using the default partitioner and producing records with a <code>null</code> key, the first record is randomly assigned to a partition and subsequent records are assigned to the same partition until the batch is flushed to the broker. The next record is then randomly assigned to one of the other partitons and the process repeats itself. When records were produced to the <code>two-p-topic</code> with the <code>--sync option</code>, the producer randomly selects the next partition to produce each subsequent record to but since there is only one available partition other than the partition just produced to, the records end up being alternately produced to the two available partitions.</p>
</div>
<div class="paragraph">
<p>With the <code>three-p-topic</code> and its three partitions, the producer follows the same random selection of the next partition to produce each subsequent record to, but in this case there are two partitions available and either might get selected. The result is that the records don&#8217;t get produced to partitions <code>0</code>, <code>1</code>, and <code>2</code> in a repetitive order but instead in a random order with quite possibly an uneven distribution of records across the three partitions.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_3">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute the following command to completely cleanup your environment:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose down -v</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion_2">Conclusion</h4>
<div class="paragraph">
<p>You created a Topic with multiple Partitions. You then used the <code>kafka-console-producer</code> to write some data to the Topic. Finally you analyzed the order of the data output by the <code>kafka-console-consumer</code> and noticed that the order is not deterministic.</p>
</div>
<div class="paragraph">
<p> <br>
 <br>
 <br></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_03_providing_durability">Lab 03 Providing Durability</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_investigating_the_distributed_log">a. Investigating the Distributed Log</h3>
<div class="paragraph">
<p>In this exercise, you will investigate the distributed log. You will then simulate a Broker failure, and see how to recover the Broker.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_3">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Make sure your Kafka cluster is started, <strong>otherwise</strong> execute this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_observing_the_distributed_log">Observing the Distributed Log</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Topic called <code>replicated-topic</code> with six Partitions and two replicas:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --create \
    --bootstrap-server kafka-1:19092 \
    --topic replicated-topic \
    --partitions 6 \
    --replication-factor 2</strong></pre>
</div>
</div>
</li>
<li>
<p>View the Topic information to see that it has been created correctly. The exact output may vary depending on which Brokers the Topic-Partition replicas were assigned.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Connect to Control Center. If necessary, open a browser tab to the URL <a href="http://localhost:9021" class="bare">http://localhost:9021</a></p>
</li>
<li>
<p>In Control Center, click on <strong>Topics</strong>:</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-topics-menu.png" alt="c3 topics menu">
</div>
</div>
</li>
<li>
<p>Scroll through the Topics list until you find <code>replicated-topic</code> and click on the topic name.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-topic-overview.png" alt="c3 topic overview">
</div>
</div>
<div class="paragraph">
<p>A detailed view of the topic opens in the right pane with the <strong>Overview</strong> tab selected.</p>
</div>
</li>
<li>
<p>Notice the Topicâs Partition list and the corresponding Brokers where each Partition replica resides.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-partitions.png" alt="c3 partitions">
</div>
</div>
</li>
<li>
<p>You can also view the same Topic information via Kafka command line tools. In your terminal, describe the Topic:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --describe \
    --bootstrap-server kafka-1:19092 \
    --topic replicated-topic</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Topic:replicated-topic	PartitionCount:6	ReplicationFactor:2	Configs:
	Topic: replicated-topic	Partition: 0	Leader: 102	Replicas: 102,101	Isr: 102,101
	Topic: replicated-topic	Partition: 1	Leader: 103	Replicas: 103,102	Isr: 103,102
	Topic: replicated-topic	Partition: 2	Leader: 101	Replicas: 101,103	Isr: 101,103
	Topic: replicated-topic	Partition: 3	Leader: 102	Replicas: 102,103	Isr: 102,103
	Topic: replicated-topic	Partition: 4	Leader: 103	Replicas: 103,101	Isr: 103,101
	Topic: replicated-topic	Partition: 5	Leader: 101	Replicas: 101,102	Isr: 101,102</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Produce some data to send to the Topic <code>replicated-topic</code>. Leave this process running until it finishes. The following command line sends 6000 messages, 100 bytes in size, at a rate of 1000 messages/sec:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-producer-perf-test \
    --topic replicated-topic \
    --num-records 6000 \
    --record-size 100 \
    --throughput 1000 \
    --producer-props bootstrap.servers=kafka-1:19092,kafka-2:29092,kafka-3:39092</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4999 records sent, 999.8 records/sec (0.10 MB/sec), 5.2 ms avg latency, 298.0 max latency.
6000 records sent, 998.336106 records/sec (0.10 MB/sec), 4.69 ms avg latency, 298.00 ms max latency, 2 ms 50th, 25 ms 95th, 35 ms 99th, 46 ms 99.9th.</pre>
</div>
</div>
</li>
<li>
<p>Start the console Producer for the same Topic <code>replicated-topic</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer \
    --bootstrap-server kafka-1:19092,kafka-2:29092,kafka-3:39092 \
    --topic replicated-topic</strong></pre>
</div>
</div>
</li>
<li>
<p>At the <code>&gt;</code> prompt, type âI heart logsâ and press Enter. Add five more messages and then press <code>Ctrl+D</code> to exit the console Producer:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>&gt; I heart logs
&gt; Hello world
&gt; All your base
&gt; Kafka rules
&gt; Don't worry
&gt; Be happy
&lt;Ctrl+D&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_examine_checkpoint_files">Examine Checkpoint Files</h4>
<div class="paragraph">
<p>For each Broker (<code>kafka-1</code>, <code>kafka-2</code> and <code>kafka3</code>)  examine the contents of the checkpoint files <code>recovery-point-offset-checkpoint</code> and <code>replication-offset-checkpoint</code> at <code>/var/lib/kafka/data</code>. Let&#8217;s start with the first Broker called <code>kafka-1</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The next steps will be run on the Broker. From your host system, open a new terminal and connect to the Broker, here <code>kafka-1</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose exec kafka-1 /bin/bash</strong>
[appuser@kafka-1 ~]$</pre>
</div>
</div>
</li>
<li>
<p>The <code>recovery-point-offset-checkpoint</code> file records the point up to which data has been flushed to disks. This is important as, on hard failure, the Broker needs to scan unflushed data, verify the CRC, and truncate the corrupted log.</p>
<div class="listingblock">
<div class="content">
<pre>[appuser@kafka-1 ~]$ <strong>cat \
/var/lib/kafka/data/recovery-point-offset-checkpoint | \
    grep replicated-topic</strong>
replicated-topic 1 0
replicated-topic 2 0
replicated-topic 3 0
replicated-topic 4 0</pre>
</div>
</div>
<div class="paragraph">
<p>In the output above, the first number is the Partition number, and the second number is the offset of the last flushing point. In the output above, the offset of the last flushing point is expected to be 0 because the open file segment has not been flushed yet</p>
</div>
</li>
<li>
<p>The <code>replication-offset-checkpoint</code> file is the offset of the last committed offset (e.g. the <strong>high water mark</strong>).</p>
<div class="listingblock">
<div class="content">
<pre>[appuser@kafka-1 ~]$ <strong>cat \
/var/lib/kafka/data/replication-offset-checkpoint | \
    grep replicated-topic</strong>
replicated-topic 3 922
replicated-topic 1 1077
replicated-topic 2 1078
replicated-topic 4 1133</pre>
</div>
</div>
<div class="paragraph">
<p>In the output above, the first number is the Partition number, and the second number is the offset of the high water mark. The offset of the high water mark is expected to be different on each partition because the number of produced messages, 6006 (6000 + 6) was not evenly distributed across the six Partitions due to the sticky partitioner.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Your high water marks will likely be slightly different than those shown in the above example.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Disconnect from the Broker container by pressing <code>Ctrl+D</code>.</p>
</li>
<li>
<p>Repeat the previous steps for the other two Brokers <code>kafka-2</code> and <code>kafka-3</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_examining_topic_partitions">Examining Topic Partitions</h4>
<div class="paragraph">
<p>On each of the Brokers, examine the contents of one of the data directories for at least one of the Topic-Partitions. For example, the directory <code>replicated-topic-0</code> has log files for Partition 0 of Topic <code>replicated-topic</code>. The following steps will list the log files for Partition 0 on the <code>kafka-1</code> Broker.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From your host system connect to the <code>kafka-1</code> Broker container:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose exec kafka-1 /bin/bash</strong>
[appuser@kafka-1 ~]$</pre>
</div>
</div>
</li>
<li>
<p>List the directory <code>replicated-topic-0</code>:</p>
<div class="listingblock">
<div class="content">
<pre>[appuser@kafka-1 ~]$ <strong>ls -l /var/lib/kafka/data/replicated-topic-0</strong>
total 132
-rw-r--r-- 1 appuser appuser 10485760 Oct 23 01:35 00000000000000000000.index
-rw-r--r-- 1 appuser appuser   121393 Oct 23 01:36 00000000000000000000.log
-rw-r--r-- 1 appuser appuser 10485756 Oct 23 01:35 00000000000000000000.timeindex
-rw-r--r-- 1 appuser appuser        8 Oct 23 01:34 leader-epoch-checkpoint</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The command may return the following error:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ls: cannot access /var/lib/kafka/data/replicated-topic-0: No such file or directory</pre>
</div>
</div>
<div class="paragraph">
<p>Why would this error occur?</p>
</div>
<div class="paragraph">
<p>The directory <code>replicated-topic-0</code> does not exist on all three Brokers in your cluster.</p>
</div>
<div class="paragraph">
<p>Why not?</p>
</div>
<div class="paragraph">
<p>Remember that a Broker may not store every Partition for a Topic. As shown in the Partition lists earlier, each Broker only contains a subset of the Partitions for <code>replicated-topic</code>. If you get an error when trying to list the <code>replicated-topic-0</code> directory, the Partition is on another Broker.</p>
</div>
<div class="paragraph">
<p>If this error occurs, repeat the command using <code>replicated-topic-1</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The data files have the following meaning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.log</code> holds the messages and metadata</p>
</li>
<li>
<p><code>.index</code> maps message offsets to their byte position in the log file</p>
</li>
<li>
<p><code>.timeindex</code> maps message timestamps to their offset number</p>
</li>
<li>
<p><code>leader-epoch-checkpoint</code> maps the leader epoch to its corresponding start offset</p>
</li>
</ul>
</div>
</li>
<li>
<p>On the Brokers, view the contents of the file <code>leader-epoch-checkpoint</code>:</p>
<div class="listingblock">
<div class="content">
<pre>[appuser@kafka-1 ~]$ <strong>cat \
/var/lib/kafka/data/replicated-topic-0/leader-epoch-checkpoint</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This file tracks the lineage of the Partition leadership by noting which offset starts a new leader generation. The first row denotes the version of the file format, in this case <code>0</code>. The second row denotes the number of epochs, which is incremented every leader election. This Partition has only had one leader in its history, so it is still in its first epoch. Each row afterwards shows the epoch ID followed by the offset where the epoch begins. In this case, the current epoch ID is <code>0</code> and starts at offset <code>0</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>0
1
0 0</code></pre>
</div>
</div>
</li>
<li>
<p>On the Broker, use the <code>kafka-dump-log</code> tool to view details of the <code>.log</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>[appuser@kafka-1 ~]$ <strong>kafka-dump-log \
    --print-data-log \
    --files \
/var/lib/kafka/data/replicated-topic-0/00000000000000000000.log</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The command output should be similar to (shortened):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Dumping /var/lib/kafka/data/replicated-topic-0/00000000000000000000.log
Starting offset: 0
baseOffset: 0 lastOffset: 1 count: 2 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 0 CreateTime: 1603416922512 size: 279 magic: 2 compresscodec: NONE crc: 2708005014 isvalid: true
| offset: 0 CreateTime: 1603416922512 keysize: -1 valuesize: 100 sequence: -1 headerKeys: [] payload: SSXVNJHPDQDXVCRASTVYBCWVMGNYKRXVZXKGXTSPSJDGYLUEGQFLAQLOCFLJBEPOWFNSOMYARHAOPUFOJHHDXEHXJBHWGSMZJGNL
| offset: 1 CreateTime: 1603416922512 keysize: -1 valuesize: 100 sequence: -1 headerKeys: [] payload: SSXVNJHPDQDXVCRASTVYBCWVMGNYKRXVZXKGXTSPSJDGYLUEGQFLAQLOCFLJBEPOWFNSOMYARHAOPUFOJHHDXEHXJBHWGSMZJGNL
...
| offset: 887 CreateTime: 1603416928132 keysize: -1 valuesize: 100 sequence: -1 headerKeys: [] payload: SSXVNJHPDQDXVCRASTVYBCWVMGNYKRXVZXKGXTSPSJDGYLUEGQFLAQLOCFLJBEPOWFNSOMYARHAOPUFOJHHDXEHXJBHWGSMZJGNL
baseOffset: 888 lastOffset: 888 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 121314 CreateTime: 1603416972594 size: 79 magic: 2 compresscodec: NONE crc: 4111803574 isvalid: true
| offset: 888 CreateTime: 1603416972594 keysize: -1 valuesize: 11 sequence: -1 headerKeys: [] payload: Don't worry</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Questions:</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Are the offsets in the <code>.log</code> file sequential?</p>
</li>
<li>
<p>Can you work out what is the offset of the message âAll your baseâ that you entered earlier? If you canât find the value in the directory <code>replicated-topic-0</code>, where else might it be?</p>
</li>
</ol>
</div>
</li>
<li>
<p>On the Broker, use the <code>DumpLogSegments</code> tool to view the offsets in the <code>.index</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>[appuser@kafka-1 ~]$ <strong>kafka-run-class kafka.tools.DumpLogSegments \
--files \
/var/lib/kafka/data/replicated-topic-0/00000000000000000000.index</strong>

Dumping /var/lib/kafka/data/replicated-topic-0/00000000000000000000.index
Dumping /var/lib/kafka/data/replicated-topic-0/00000000000000000000.index
offset: 32 position: 4172
offset: 64 position: 8466
offset: 94 position: 12638
...
...
offset: 807 position: 109936
offset: 837 position: 114060
offset: 867 position: 118245</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note the difference from one index entry position to the next is ~4000 which corresponds to the default <code>log.index.interval.bytes=4096</code> setting.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Disconnect from the Broker (container) by pressing <code>Ctrl+D</code>.</p>
</li>
<li>
<p>Repeat the above steps for the other two Brokers <code>kafka-2</code> and <code>kafka-3</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_taking_a_broker_offline">Taking a Broker Offline</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First let&#8217;s define an <strong>action</strong> in Control Center for when an under replication happens. We will see later why that is important:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open Control Center</p>
</li>
<li>
<p>Click the bell icon in the top right corner to navigate to <strong>Alerts</strong></p>
</li>
<li>
<p>Click the button <strong>Create trigger</strong></p>
</li>
<li>
<p>Complete the dialog using the following settings:</p>
<table class="tableblock frame-all grid-all stripes-even" style="width: 60%;">
<colgroup>
<col style="width: 45%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under Replicated Partitions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">controlcenter.cluster &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under replicated topic partitions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-trigger.png" alt="c3 trigger" width="500">
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>In the confirmation box, when asked to "Set actions to perform when your trigger goes off", select <strong>Create an action</strong></p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-trigger-saved.png" alt="c3 trigger saved" width="400">
</div>
</div>
</li>
<li>
<p>Complete the dialog using the following settings:</p>
<table class="tableblock frame-all grid-all stripes-even" style="width: 60%;">
<colgroup>
<col style="width: 45%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My action</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under Replicated Partitions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under replicated partitions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max send rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Per minute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recipient email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:anything@anything.com">anything@anything.com</a></p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-action.png" alt="c3 action" width="500">
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This lab will not actually trigger emails since email/SMTP settings have not been configured.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>From a terminal window discover which of the 3 Brokers currently is the controller by using this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>zookeeper-shell zk-1:12181 get /controller</strong>
Connecting to zk-1:12181

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
{"version":1,"brokerid":101,"timestamp":"1603416838481"}</pre>
</div>
</div>
<div class="paragraph">
<p>In this particular case, Broker <code>kafka-1</code> with brokerid <code>101</code> is the Controller.</p>
</div>
</li>
<li>
<p>To capture the Controller Broker name in an environment variable, execute the command that corresponds to your Controller <code>brokerid</code>:</p>
<table class="tableblock frame-all grid-all stripes-even" style="width: 70%;">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Controller</th>
<th class="tableblock halign-left valign-top">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>101</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$ <strong>export INITIAL_CONTROLLER=kafka-1</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>102</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$ <strong>export INITIAL_CONTROLLER=kafka-2</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>103</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$ <strong>export INITIAL_CONTROLLER=kafka-3</strong></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Let&#8217;s simulate the worst case. Stop the Broker that is acting as the Controller to see what happens. From your host system execute:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose stop $INITIAL_CONTROLLER</strong>

Stopping kafka-1 ... done</pre>
</div>
</div>
</li>
<li>
<p>Verify that the other Brokers are running:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From your host system use the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose ps</strong>
     Name                  Command            State                Ports
\--------------------------------------------------------------------------------------
connect           /etc/confluent/docker/run   Up (healthy)   0.0.0.0:8083-&gt;8083/tcp, 9092/tcp
control-center    /etc/confluent/docker/run   Up             0.0.0.0:9021-&gt;9021/tcp
kafka-1           /etc/confluent/docker/run   Exit 143
kafka-2           /etc/confluent/docker/run   Up             0.0.0.0:29092-&gt;29092/tcp, 9092/tcp
kafka-3           /etc/confluent/docker/run   Up             0.0.0.0:39092-&gt;39092/tcp, 9092/tcp
ksqldb-server     /etc/confluent/docker/run   Up (healthy)   0.0.0.0:8088-&gt;8088/tcp
schema-registry   /etc/confluent/docker/run   Up             0.0.0.0:8081-&gt;8081/tcp
tools             /bin/bash                   Up
zk-1              /etc/confluent/docker/run   Up             0.0.0.0:12181-&gt;12181/tcp, 2181/tcp, 2888/tcp, 3888/tcp
zk-2              /etc/confluent/docker/run   Up             2181/tcp, 0.0.0.0:22181-&gt;22181/tcp, 2888/tcp, 3888/tcp
zk-3              /etc/confluent/docker/run   Up             2181/tcp, 2888/tcp, 0.0.0.0:32181-&gt;32181/tcp, 3888/tcp</pre>
</div>
</div>
</li>
<li>
<p>Make sure that the <code>State</code> of the other Brokers marked as <code>Up</code> and initial Controller Broker as <code>Exit 143</code>.</p>
</li>
<li>
<p>From a terminal window use <code>zookeeper-shell</code> command-line tool to see which Brokers are registered with ZooKeeper:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>zookeeper-shell zk-1:12181 ls /brokers/ids</strong>

Connecting to zk-1:2181

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
[102, 103]</pre>
</div>
</div>
<div class="paragraph">
<p>In our example, the command output shows that only Brokers <code>102</code> and <code>103</code> are active.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>From the host system, review the server log for the initial Controller. Look for confirmation of the controlled shutdown succeeding:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose logs $INITIAL_CONTROLLER | tail</strong>

...
kafka-1            | [2020-10-23 01:52:12,916] INFO [Producer clientId=confluent-metrics-reporter] Proceeding to force close the producer since pending requests could not be completed within timeout 0 ms. (org.apache.kafka.clients.producer.KafkaProducer)
kafka-1            | [2020-10-23 01:52:12,920] INFO [KafkaServer id=101] shut down completed (kafka.server.KafkaServer)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All logs produced by the Brokers running inside a container are written to STDOUT and STDERR and reflected in the Docker logs. On a dedicated Broker machine, this server log data will be located at <code>/var/log/kafka/server.log</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the host system, review the Controller log for the initial Controller. Look for confirmation of the Controller role being released:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose logs $INITIAL_CONTROLLER | grep Resigned</strong>
kafka-1            | [2020-10-23 01:52:10,707] INFO [Controller id=101] Resigned (kafka.controller.KafkaController)</pre>
</div>
</div>
</li>
<li>
<p><strong>Question:</strong> If you don&#8217;t find the above entry in the log of the initial Controller Broker, where else could it be? Could another Broker have been the active controller?</p>
</li>
<li>
<p>Wait up to five minutes and then observe the cluster in Control Center.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In Control Center click <strong>Cluster 1</strong>.</p>
</li>
<li>
<p>In the <strong>Broker</strong> panel of <strong>Overview</strong>, observe the <strong>Total</strong> count decrease to <strong>2</strong>:</p>
</li>
<li>
<p>In the <strong>Topics</strong> panel of <strong>Overview</strong>, observe the <strong>Under replicated partitions</strong> count (should be non-zero).</p>
</li>
<li>
<p>Click on <strong>Topics</strong>.</p>
</li>
<li>
<p>Scroll through the topic list to locate <code>replicated-topic</code> and click the topic name.</p>
</li>
<li>
<p>On the <strong>Overview</strong> tab, notice there are now <strong>Under replicated partitions</strong>:</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-replication-failure.png" alt="c3 replication failure">
</div>
</div>
</li>
<li>
<p>Click the bell icon in the top right corner to view the alert history and notice that the broker down event triggered an alert. It is critical to monitor under replicated partitions to ensure message durability in your Kafka cluster:</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/durability/c3-alert-underreplicated.png" alt="c3 alert underreplicated">
</div>
</div>
</li>
<li>
<p>Start the console Producer for the same Topic <code>replicated-topic</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer \
    --bootstrap-server kafka-1:19092,kafka-2:29092,kafka-3:39092 \
    --topic replicated-topic</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Clients send the cluster metadata request to <code>bootstrap-server</code> brokers in a random order. You may see a warning message if the initial metadata request is sent to a broker that is not running.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>At the <code>&gt;</code> prompt, type six more messages and then press <code>Ctrl+D</code> to exit the console Producer:</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Kafka
&gt; Distributed
&gt; Secure
&gt; Real-time
&gt; Scalable
&gt; Fast
&lt;Ctrl+D&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>From your host system view the impact to leader epoch:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>First run <code>kafka-topics</code> again to identify which <code>replicated-topic</code> partitions had a preferred replica that was the initial Controller Broker. It would have been the leader replica when the topic was created. Since we shut this broker down, leader election would have occurred and these partitions would have been assigned a new leader:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --describe \
    --bootstrap-server kafka-1:19092,kafka-2:29092,kafka-3:39092 \
    --topic replicated-topic</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Topic: replicated-topic	PartitionCount: 6	ReplicationFactor: 2	Configs: segment.bytes=536870912,retention.bytes=536870912
	Topic: replicated-topic	Partition: 0	Leader: 102	Replicas: 102,103	Isr: 102,103	Offline:
	Topic: replicated-topic	Partition: 1	Leader: 102	Replicas: 101,102	Isr: 102	Offline: 101
	Topic: replicated-topic	Partition: 2	Leader: 103	Replicas: 103,101	Isr: 103	Offline: 101
	Topic: replicated-topic	Partition: 3	Leader: 102	Replicas: 102,101	Isr: 102	Offline: 101
	Topic: replicated-topic	Partition: 4	Leader: 103	Replicas: 101,103	Isr: 103	Offline: 101
	Topic: replicated-topic	Partition: 5	Leader: 103	Replicas: 103,102	Isr: 103,102	Offline:</code></pre>
</div>
</div>
</li>
<li>
<p>On either of the other two Brokers, view the contents of the file <code>leader-epoch-checkpoint</code> in one of the Topic-Partitions subdirectory for which the initial Controller Broker was the leader replica:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose exec kafka-2 cat \
/var/lib/kafka/data/replicated-topic-2/leader-epoch-checkpoint</strong>
0
2
0 0
1 1077</pre>
</div>
</div>
<div class="paragraph">
<p>This Partition now reflects that it has had two leaders. Leader epoch <code>0</code> had an initial offset of <code>0</code>. Leader epoch <code>1</code> has an initial offset of <code>1077</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Your leader epoch <code>1</code> may have a slightly different initial offset.</p>
</li>
<li>
<p>If you see the following response to the above command, it indicates that no leader election has occurred for that partition.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>0
1
0 0</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_bringing_a_broker_online">Bringing a Broker Online</h4>
<div class="paragraph">
<p>Bringing a Broker online is as simple as restarting the Broker and letting Kafka automatically rebalance the leaders.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From your host system restart the initial Controller Broker:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose start $INITIAL_CONTROLLER</strong></pre>
</div>
</div>
</li>
<li>
<p>Wait five minutes and then observe the cluster in Control Center:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In Control Center, click <strong>Cluster 1</strong>.</p>
</li>
<li>
<p>In the <strong>Broker</strong> panel of <strong>Overview</strong>, observe the <strong>Total</strong> count as it returns to <strong>3</strong>.</p>
</li>
<li>
<p>In the <strong>Topics</strong> panel of <strong>Overview</strong>, observe the <strong>Under replicated partitions</strong> count as it returns to 0.</p>
</li>
<li>
<p>Click on <strong>Topics</strong>.</p>
</li>
<li>
<p>Scroll through the topic list to locate <code>replicated-topic</code> and click the topic name.</p>
</li>
<li>
<p>On the <strong>Overview</strong> tab, notice the <strong>Under replicated partitions</strong> has returned to 0.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200]">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_04_managing_a_kafka_cluster">Lab 04 Managing a Kafka Cluster</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_exploring_configuration">a. Exploring Configuration</h3>
<div class="paragraph">
<p>In this exercise, you will research a few important Broker properties of a Kafka cluster.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_4">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Make sure your Kafka cluster is started, <strong>otherwise</strong> execute this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_jigsaw">Configuration Jigsaw</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to Control Center. If necessary, open a browser tab to the URL <code><a href="http://localhost:9021" class="bare">http://localhost:9021</a></code>.</p>
</li>
<li>
<p>Select <strong>Cluster 1</strong> on the left hand side, then click <strong>Brokers</strong> and you will see the <strong>Brokers overview</strong> view:</p>
<div class="imageblock">
<div class="content">
<img src="./images/managing/c3-broker-overview.png" alt="c3 broker overview">
</div>
</div>
<div class="paragraph">
<p>Observe the metrics you see on this view. Do they correspond to what you&#8217;d expect to view on a first glance? Why yes? Why not?</p>
</div>
</li>
<li>
<p>On the left side select <strong>Cluster settings</strong> and then select the tab <strong>Broker defaults</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="./images/managing/c3-cluster-settings.png" alt="c3 cluster settings">
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click the <strong>Hide settings set to default value</strong> toggle button to display all Cluster settings in the list.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Spend 5 minutes looking at the different categories of properties, and perhaps read a few of the descriptions provided (the description pops up when hovering your mouse over a property). There are many configuration settings, so don&#8217;t get too focused on one property in particular.</p>
<div class="ulist">
<ul>
<li>
<p>What do you notice? Write down a few observations.</p>
</li>
<li>
<p>What do you wonder? Write down a few questions that arise.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Here are some sets of configuration properties. Choose <strong>one</strong> set of properties and take 15 minutes to research what they do, what some reasonable values are, and what some unreasonable (but valid) values might be.</p>
<div class="ulist">
<ul>
<li>
<p>listeners:</p>
<div class="ulist">
<ul>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>advertised.listeners</code></p>
</li>
<li>
<p><code>listener.security.protocol.map</code></p>
</li>
<li>
<p><code>control.plane.listener.name</code></p>
</li>
<li>
<p><code>inter.broker.listener.name</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>logs (<em>i.e.</em> cluster default properties for Topics, Partitions, and replicas):</p>
<div class="ulist">
<ul>
<li>
<p><code>log.dirs</code></p>
</li>
<li>
<p><code>default.replication.factor</code></p>
</li>
<li>
<p><code>log.retention.hours</code></p>
</li>
<li>
<p><code>log.segment.bytes</code></p>
</li>
<li>
<p><code>log.roll.ms</code></p>
</li>
<li>
<p><code>num.partitions</code></p>
</li>
<li>
<p><code>replica.lag.time.max.ms</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>network:</p>
<div class="ulist">
<ul>
<li>
<p><code>broker.id</code></p>
</li>
<li>
<p><code>zookeeper.connect</code></p>
</li>
<li>
<p><code>zookeeper.session.timeout.ms</code></p>
</li>
<li>
<p><code>group.max.session.timeout.ms</code></p>
</li>
<li>
<p><code>sasl.enabled.mechanisms</code></p>
</li>
<li>
<p><code>max.connections.per.ip</code></p>
</li>
<li>
<p><code>max.connections.per.ip.overrides</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>CPU:</p>
<div class="ulist">
<ul>
<li>
<p><code>num.io.threads</code></p>
</li>
<li>
<p><code>num.network.threads</code></p>
</li>
<li>
<p><code>num.recovery.threads.per.data.dir</code></p>
</li>
<li>
<p><code>num.replica.fetchers</code></p>
</li>
<li>
<p><code>background.threads</code></p>
</li>
<li>
<p><code>log.cleaner.threads</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is just a first exposure. Many of these properties will be explored in more detail in upcoming material, so don&#8217;t worry too much if you still have questions at this point. Record your questions and come back to them later towards the end of training to make sure they get answered.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p> </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200]">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p> <br></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_b_increasing_replication_factor">b. Increasing Replication Factor</h3>
<div class="paragraph">
<p>We all make mistakes. Maybe you accidentally created a mission-critical Topic with a replication factor of 1. Luckily, you notice this before disaster strikes. In this exercise, you will use the <code>kafka-reassign-partitions</code> tool to increase the replication factor of a Topic. The <code>kafka-reassign-partitions</code> tool is an included utility that is usually used to rebalance the load of Partitions across Brokers. It will be discussed in further detail later in the course.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_5">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Make sure your Kafka cluster is started, <strong>otherwise</strong> execute this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_increasing_replication_factor">Increasing Replication Factor</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Topic called <code>test</code> with 3 Partitions and replication factor 1.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092,kafka-2:29092,kafka-3:39092 \
    --create \
    --topic test \
    --partitions 3 \
    --replication-factor 1</strong></pre>
</div>
</div>
</li>
<li>
<p>View the Topic information. Partitions may land on different Brokers than shown here.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092,kafka-2:29092,kafka-3:39092 \
    --describe \
    --topic test</strong>

Topic:test	PartitionCount:3	ReplicationFactor:1	Configs:
	Topic: test	Partition: 0	Leader: 103	Replicas: 103	Isr: 103
	Topic: test	Partition: 1	Leader: 102	Replicas: 102	Isr: 102
	Topic: test	Partition: 2	Leader: 101	Replicas: 101	Isr: 101</pre>
</div>
</div>
</li>
<li>
<p>Create a <code>json</code> file called <code>replicate_topic_test_plan.json</code> that declares your desired state of Partition replication. Notice that <code>kafka-reassign-partitions</code> allows you to set replication factor on a per-Partition basis.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cat &lt;&lt; EOF &gt; replicate_topic_test_plan.json
{"version":1,
          "partitions":[
               {"topic":"test","partition":0,"replicas":[101,102,103]},
               {"topic":"test","partition":1,"replicas":[101,102,103]},
               {"topic":"test","partition":2,"replicas":[102,103]}]
}
EOF</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notice that we declare Partition 2 to only have 2 replicas. This shows the granular control of the <code>kafka-reassign-partitions</code> tool. Also note the first of each list will become the preferred replica.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the <code>--reassignment-json-file</code> and <code>--execute</code> options of the <code>kafka-reassign-partitions</code> tool to execute the change.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-reassign-partitions \
     --bootstrap-server kafka-1:19092,kafka-2:29092,kafka-3:39092 \
     --reassignment-json-file replicate_topic_test_plan.json \
     --zookeeper zk-1:12181 \
     --execute</strong>

Current partition replica assignment

{"version":1,"partitions":[{"topic":"test","partition":2,"replicas":[
101],"log_dirs":["any"]},{"topic":"test","partition":1,"replicas":[10
2],"log_dirs":["any"]},{"topic":"test","partition":0,"replicas":[103]
,"log_dirs":["any"]}]}

Save this to use as the --reassignment-json-file option during rollback
Successfully started partition reassignments for test-0,test-1,test-2</pre>
</div>
</div>
</li>
<li>
<p>View the Topic information again to see that the Partitions are now replicated.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092,kafka-2:29092,kafka-3:39092 \
    --describe \
    --topic test</strong>

Topic:test	PartitionCount:3	ReplicationFactor:3	Configs:
	Topic: test	Partition: 0	Leader: 103	Replicas: 101,102,103	Isr: 103,101,102
	Topic: test	Partition: 1	Leader: 102	Replicas: 101,102,103	Isr: 102,101,103
	Topic: test	Partition: 2	Leader: 102	Replicas: 102,103	Isr: 102,103</pre>
</div>
</div>
<div class="paragraph">
<p> <br></p>
</div>
</li>
</ol>
</div>
<hr>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div class="paragraph">
<p> <br></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_kafka_administrative_tools">c. Kafka Administrative Tools</h3>
<div class="paragraph">
<p>In this exercise, you will delete a Topic, reassign Partitions, and simulate a completely failed Broker.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_6">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Make sure your Kafka cluster is started, <strong>otherwise</strong> execute this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_topics_in_the_cluster">Deleting Topics in the Cluster</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to Control Center. If necessary, open a browser tab to the URL <code><a href="http://localhost:9021" class="bare">http://localhost:9021</a></code>.</p>
</li>
<li>
<p>Verify that three Brokers are running. In the Control Center <strong>Overview</strong> view, observe the Broker count is three.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/managing/c3-broker-overview-2.png" alt="c3 broker overview 2" width="600">
</div>
</div>
</li>
<li>
<p>Delete the Topic <code>replicated-topic</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --delete \
    --topic replicated-topic</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When deleting a Topic, always make sure you don&#8217;t have any Producers or Consumers running. Otherwise, the Topic will be re-created automatically. Also, you may have already deleted this Topic when destroying the cluster with <code>docker-compose down -v</code>. If so, create the Topic again, verify it exists, and then delete it.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the Control Center, check that the Topic <code>replicated-topic</code> is now gone from the list of topics in the Topic Management view.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Topic may not disappear immediately. If necessary wait a few minutes.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="rebalancing-cluster">Rebalancing the Cluster</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Topic called <code>moving</code> with 6 Partitions and 2 replicas, on only Broker 1 and Broker 2 (with IDs <code>101</code> and <code>102</code>):</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic moving \
    --replica-assignment 101:102,102:101,101:102,102:101,101:102,102:101</strong></pre>
</div>
</div>
</li>
<li>
<p>Run the command line tool <code>kafka-producer-perf-test</code> to produce 2GB of data to Topic <code>moving</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Wait until this command has completed before continuing.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-producer-perf-test \
    --topic moving \
    --num-records 2000000 \
    --record-size 1000 \
    --throughput 1000000000 \
    --producer-props bootstrap.servers=kafka-1:19092,kafka-2:29092</strong></pre>
</div>
</div>
</li>
<li>
<p>Verify which Brokers contain Partitions for the Topic <code>moving</code>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Control Center UI make sure you select <strong>Cluster 1</strong></p>
</li>
<li>
<p>Then select the tab <strong>Topics</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="./images/managing/c3-topic-list.png" alt="c3 topic list">
</div>
</div>
</li>
<li>
<p>In the list of topics select the <code>moving</code> topic:</p>
<div class="imageblock">
<div class="content">
<img src="./images/managing/c3-topic-overview.png" alt="c3 topic overview">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notice the Topic&#8217;s Partition list and the corresponding Brokers where each Partition replica resides. They are all on Brokers 101 and 102.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In Control Center on the left side, select <strong>Brokers</strong>.</p>
</li>
<li>
<p>In the <strong>Brokers overview</strong> view, look at the metric <strong>Disk</strong>. Notice the red bar to indicate a cluster imbalance:  (may take a couple of minutes)</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/managing/c3-skewed-disk.png" alt="c3 skewed disk" width="600">
</div>
</div>
</li>
<li>
<p>Consume some data from the Topic <code>moving</code>. Leave this consumer running for the duration of the exercise:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-perf-test \
    --bootstrap-server kafka-1:19092,kafka-2:29092 \
    --topic moving \
    --group test-group \
    --threads 1 \
    --show-detailed-stats \
    --timeout 1000000 \
    --reporting-interval 5000 \
    --messages 10000000</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>time, threadId, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec
2018-10-03 12:21:58:622, 0, 172.8697, 34.1437, 181267, 35802.2911, 3033, 2030, 85.1575, 89294.0887
2018-10-03 12:22:03:622, 0, 684.5884, 102.3438, 717843, 107315.2000, 0, 5000, 102.3438, 107315.2000
2018-10-03 12:22:08:622, 0, 1249.4726, 112.9768, 1310167, 118464.8000, 0, 5000, 112.9768, 118464.8000
2018-10-03 12:22:13:624, 0, 1646.5025, 79.3742, 1726483, 83229.9080, 0, 5002, 79.3742, 83229.9080
...</pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The next few steps use the Confluent Auto Data Balancer to rebalance the cluster. If you prefer to use the Apache open source tool instead, you may view the Appendix section of this manual called <strong>Reassigning Partitions in a Topic: Alternate Method</strong> (&#8594; <a href="#appendix-reassign-partitions">Jump here</a>). Note the open source tool requires users to enumerate every Topic to rebalance and does not take into consideration disk utilization per Broker.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Run the Confluent Auto Data Balancer to rebalance the cluster. This will distribute the Partitions in the cluster, including the Topic <code>moving</code>, so that the Brokers are more evenly utilized. Wait for a few seconds for it to compute the rebalance plan.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>confluent-rebalancer execute \
    --bootstrap-server kafka-1:19092 \
    --metrics-bootstrap-server kafka-1:19092,kafka-2:29092 \
    --throttle 1000000 \
    --verbose</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>Computing the rebalance plan (this may take a while) ...
You are about to move 5 replica(s) for 5 partitions to 2 broker(s) with total size 1,348.5 MB.
The preferred leader for 9 partition(s) will be changed.
In total, the assignment for 10 partitions will be changed.
The minimum free volume space is set to 20.0%.

The following brokers will have less than 40% of free volume space during the rebalance:
	Broker     Current Size (MB)  Size During Rebalance (MB)   Free % During Rebalance      Size After Rebalance (MB)    Free % After Rebalance
	101        2,046.8            2,046.8                      36.2                         2,046.8                      36.2
	103        21.2               1,369.7                      31.8                         1,369.7                      31.8
	102        2,046.8            2,046.8                      36.2                         2,046.8                      36.2

Min/max stats for brokers (before -&gt; after):
	Type  Leader Count                 Replica Count                Size (MB)
	Min   99 (id: 101) -&gt; 101 (id: 101) 298 (id: 103) -&gt; 301 (id: 101) 21.2 (id: 103) -&gt; 1,369.7 (id: 103)
	Max   105 (id: 103) -&gt; 102 (id: 102) 303 (id: 101) -&gt; 301 (id: 101) 2,046.8 (id: 101) -&gt; 1,374 (id: 102)
No racks are defined.

Broker stats (before -&gt; after):
	Broker     Leader Count    Replica Count   Size (MB)            Free Space (%)
	101        99 -&gt; 101       303 -&gt; 301      2,046.8 -&gt; 1,371     36.2 -&gt; 38.3
	102        101 -&gt; 102      302 -&gt; 301      2,046.8 -&gt; 1,374     36.2 -&gt; 38.3
	103        105 -&gt; 102      298 -&gt; 301      21.2 -&gt; 1,369.7      36.2 -&gt; 31.8

Would you like to continue? (y/n):</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>To start the rebalance operation, type <code>y</code> and press <strong>Enter</strong>.</p>
<div class="paragraph">
<p>The following response will appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The rebalance has been started, run `status` to check progress.

Warning: You must run the `status` or `finish` command periodically, until the rebalance completes, to ensure the throttle is removed. You can also alter the throttle by re-running the execute command passing a new value.</pre>
</div>
</div>
</li>
<li>
<p>Observe the configured throttling limits:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-configs \
    --bootstrap-server kafka-1:19092 \
    --describe \
    --entity-type brokers</strong>
Dynamic configs for broker 101 are:
  leader.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000}
  follower.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000}
Dynamic configs for broker 102 are:
  leader.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000}
  follower.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000}
Dynamic configs for broker 103 are:
  leader.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000}
  follower.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000}
Default configs for brokers in the cluster are:</pre>
</div>
</div>
</li>
<li>
<p>Verify that throttling is in effect for topic <code>moving</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-configs     --bootstrap-server kafka-1:19092     --describe     --topic moving</strong>
Dynamic configs for topic moving are:
  leader.replication.throttled.replicas=0:101,0:102,1:101,1:102,2:101,2:102,4:101,4:102 sensitive=false synonyms={DYNAMIC_TOPIC_CONFIG:leader.replication.throttled.replicas=0:101,0:102,1:101,1:102,2:101,2:102,4:101,4:102}
  follower.replication.throttled.replicas=0:103,1:103,2:103,4:103 sensitive=false synonyms={DYNAMIC_TOPIC_CONFIG:follower.replication.throttled.replicas=0:103,1:103,2:103,4:103}</pre>
</div>
</div>
</li>
<li>
<p>Monitor the progress of the rebalancing:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>confluent-rebalancer status \
    --bootstrap-server kafka-1:19092</strong>
Partitions being rebalanced:
	Topic moving: 0,1,2,4</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Your status may indicate different partitions being rebalanced.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Increase the throttle limit configuration to 1GBps by rerunning the <code>confluent-rebalancer</code> command with the new throttle limit:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>confluent-rebalancer execute \
    --bootstrap-server kafka-1:19092 \
    --metrics-bootstrap-server kafka-1:19092,kafka-2:29092 \
    --throttle 1000000000 \
    --verbose</strong>
The throttle rate was updated to 1000000000 bytes/sec.
A rebalance is currently in progress for:
	Topic moving: 0,1,2,4</pre>
</div>
</div>
</li>
<li>
<p>Note the updated throttle limit configuration values.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-configs \
    --describe \
    --bootstrap-server kafka-1:19092 \
    --entity-type brokers</strong>
Dynamic configs for broker 101 are:
  leader.replication.throttled.rate=1000000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000000}
  follower.replication.throttled.rate=1000000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000000}
Dynamic configs for broker 102 are:
  leader.replication.throttled.rate=1000000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000000}
  follower.replication.throttled.rate=1000000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000000}
Dynamic configs for broker 103 are:
  leader.replication.throttled.rate=1000000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000000}
  follower.replication.throttled.rate=1000000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000000}
Default configs for brokers in the cluster are:</pre>
</div>
</div>
</li>
<li>
<p>Check the status of the Auto Data Balancer again.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>confluent-rebalancer status \
    --bootstrap-server kafka-1:19092</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it has completed:</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>Error: No rebalance is currently in progress. If you have called `status` after a rebalance was started successfully, the rebalance has completed. Run the `execute` command to check if the cluster is balanced.</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check to see if topic <code>moving</code> is still throttled:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-configs \
    --bootstrap-server kafka-1:19092 \
    --describe \
    --topic moving</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Note that all throttles have been removed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Dynamic configs for topic moving are:</pre>
</div>
</div>
</li>
<li>
<p>Wait up to five minutes. In the Control Center <code>Broker overview</code>, look at the metric <code>Disk</code>. Notice the red bar is no longer present.</p>
</li>
<li>
<p>View the Topic information to see that the Topic <code>moving</code> has its Partitions moved across all three Brokers.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/managing/c3-skewed-fixed.png" alt="c3 skewed fixed" width="600">
</div>
</div>
</li>
<li>
<p>Return to the terminal running the Consumer. Press <code>Ctrl+C</code> to exit the Consumer.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="simulate-failed-broker">Simulate a Completely Failed Broker</h4>
<div class="paragraph">
<p>In previous exercises, the Broker failures were such that the Broker could be simply restarted to recover. Now you will simulate a completely failed Broker which requires a replacement system.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a new terminal from the host, observe the logs on Broker 1.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose exec kafka-1 ls /var/lib/kafka/data</strong>
...
moving-2
moving-3
moving-4
moving-5
recovery-point-offset-checkpoint
replication-offset-checkpoint
...</pre>
</div>
</div>
</li>
<li>
<p>Stop and remove Broker 1 (this also removes the data of Broker 1).</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose stop kafka-1 &amp;&amp; \
    docker-compose rm kafka-1 &amp;&amp; \
    docker volume rm confluent-admin_data-kafka-1</strong>
Stopping kafka-1 ... done

Going to remove kafka-1
Are you sure? [yN] y
Removing kafka-1 ... done

confluent-admin_data-kafka-1</pre>
</div>
</div>
</li>
<li>
<p>In the Control Center under <strong>Overview</strong>, verify that only 2 Brokers are available.</p>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may have to wait up to five minutes for the Broker to disappear.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Restart Broker 1:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose up -d</strong>

control-center is up-to-date
zk-1 is up-to-date
zk-2 is up-to-date
ksql-cli is up-to-date
ksql-server is up-to-date
zk-3 is up-to-date
kafka-2 is up-to-date
schema-registry is up-to-date
kafka-3 is up-to-date
connect is up-to-date
Creating kafka-1 ... done</pre>
</div>
</div>
</li>
<li>
<p>In the Control Center under <strong>Overview</strong> verify that all three Brokers are running.</p>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may have to wait up to five minutes for the previously failed Broker to reappear.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Notice that there are under replicated and offline Topic Partitions. After a moment of recovery they will return back to zero though.</p>
</li>
<li>
<p>Look at the logs in <code>/var/lib/kafka/data</code>. Verify that Broker 1 has not lost any of the data it had in step 1:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose exec kafka-1 ls /var/lib/kafka/data</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_05_optimizing_kafkas_performance">Lab 05 Optimizing Kafka&#8217;s Performance</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_exploring_producer_performance">a. Exploring Producer Performance</h3>
<div class="sect3">
<h4 id="_prerequisites_7">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Make sure your Kafka cluster is started, <strong>otherwise</strong> execute this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_tuning_producer_performance">Tuning Producer Performance</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Topic called <code>performance</code> with six Partitions and three replicas.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic performance \
    --partitions 6 \
    --replication-factor 3</strong></pre>
</div>
</div>
</li>
<li>
<p>Run Producer performance tests to compare <code>acks=all</code>, <code>acks=1</code>, and <code>acks=0</code></p>
<div class="paragraph">
<p>Use the following command line and replace <code>&lt;VARIABLE_HERE&gt;</code> with the specified options in the table below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-producer-perf-test \
    --topic performance \
    --num-records 1000000 \
    --record-size 100 \
    --throughput 10000000 \
    --producer-props \
    bootstrap.servers=kafka-1:19092,kafka-2:29092 \
    &lt;VARIABLE_HERE&gt;</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Let each test run until it terminates and provides a performance summary. Record the throughput and latency results in a table. You will be appending to this table in upcoming questions.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variables</th>
<th class="tableblock halign-left valign-top">Throughput (MB/sec)</th>
<th class="tableblock halign-left valign-top">Latency (ms avg)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acks=1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acks=all</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acks=0</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Questions:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Do you get better throughput with <code>acks=0</code>, <code>acks=1</code>, or <code>acks=all</code>? What is the percentage difference in performance?</p>
</li>
<li>
<p>Do you get better latency with <code>acks=0</code>, <code>acks=1</code>, or <code>acks=all</code>? Why?</p>
</li>
</ol>
</div>
</li>
<li>
<p>You will investigate the effects of tuning <code>batch.size</code> and <code>linger.ms</code> by investigating <strong>one</strong> question. Try values of <code>batch.size</code> between 0 and 1,000,000 and values of <code>linger.ms</code> between 0 and 3,000. Hold <code>acks=all</code> constant. <strong>Choose one question to investigate</strong>. Consider dividing work amongst peers who are investigating the same question. Record your results in a table.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>What is the maximum throughput, no matter the latency?</p>
</li>
<li>
<p>What is the minimum latency, no matter the throughput?</p>
</li>
<li>
<p>What is the best balance of throughput and latency? (and defend your decision)</p>
</li>
<li>
<p>Given a batch size of 100,000 Bytes, what linger gives best performance? What do you notice? What do you wonder?</p>
</li>
<li>
<p>Given a linger of 500 ms, what batch size gives best performance? What do you notice? What do you wonder?</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is an example of a test you might run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-producer-perf-test \
    --topic performance \
    --num-records 1000000 \
    --record-size 100 \
    --throughput 10000000 \
    --producer-props \
    bootstrap.servers=kafka-1:19092,kafka-2:29092 \
    acks=all \
    batch.size=400000 \
    linger.ms=500</strong></pre>
</div>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_b_modifying_partitions_and_viewing_offsets">b. Modifying Partitions and Viewing Offsets</h3>
<div class="paragraph">
<p>In this exercise, you will increase the number of Partitions in a Topic and view offsets in an active Consumer Group.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_8">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Make sure your Kafka cluster is started, <strong>otherwise</strong> execute this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_increasing_the_number_of_partitions_in_a_topic">Increasing the Number of Partitions in a Topic</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Topic called <code>grow-topic</code> with six Partitions and three replicas:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic grow-topic \
    --partitions 6 \
    --replication-factor 3</strong></pre>
</div>
</div>
</li>
<li>
<p>View the <code>grow-topic</code> configuration and replica placement in the cluster:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In Control Center make sure you select the cluster <strong>Cluster 1</strong></p>
</li>
<li>
<p>Then, on the left side click on <code>Topics</code> and then click on the <code>grow-topic</code> Topic to see:</p>
<div class="imageblock">
<div class="content">
<img src="./images/optimizing/c3-grow-topic-before.png" alt="c3 grow topic before">
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Start the console Producer for Topic <code>grow-topic</code>.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer \
    --bootstrap-server kafka-1:19092,kafka-2:29092 \
    --topic grow-topic</strong></pre>
</div>
</div>
<div class="paragraph">
<p>At the <code>&gt;</code> prompt, type three messages and then press <code>Ctrl+D</code> to exit the console Producer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; <strong>ksqlDB</strong>
&gt; <strong>Streaming</strong>
&gt; <strong>Engine</strong>
<strong>&lt;Ctrl+D&gt;</strong></pre>
</div>
</div>
</li>
<li>
<p>Start the console Consumer for Topic <code>grow-topic</code> specifying the <code>group.id</code> property:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --consumer-property group.id=test-consumer-group \
    --from-beginning \
    --topic grow-topic \
    --bootstrap-server kafka-1:19092,kafka-2:29092</strong>

Streaming
ksqlDB
Engine</pre>
</div>
</div>
<div class="paragraph">
<p>Leave this Consumer running during the next step. Think about why it needs to keep running.</p>
</div>
</li>
<li>
<p>From another terminal window, describe the Consumer Group <code>test-consumer-group</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-groups \
    --bootstrap-server kafka-1:19092,kafka-2:29092 \
    --group test-consumer-group \
    --describe</strong>

TOPIC        PARTITION CURRENT-OFFSET LOG-END-OFFSET LAG CONSUMER-ID       HOST          CLIENT-ID
grow-topic   1         1              1              0   consumer-1-a9e... /192.168.0.6  consumer-1
grow-topic   4         0              0              0   consumer-1-a9e... /192.168.0.6  consumer-1
grow-topic   0         1              1              0   consumer-1-a9e... /192.168.0.6  consumer-1
grow-topic   3         1              1              0   consumer-1-a9e... /192.168.0.6  consumer-1
grow-topic   2         0              0              0   consumer-1-a9e... /192.168.0.6  consumer-1
grow-topic   5         0              0              0   consumer-1-a9e... /192.168.0.6  consumer-1</pre>
</div>
</div>
</li>
<li>
<p>Alter the Topic to increase the number of Partitions to 12:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --alter \
    --topic grow-topic \
    --partitions 12</strong></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If partitions are increased for a topic that has a key, the partition logic or ordering of the messages will be affected!
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Wait for a refresh of the metadata, which happens after <code>metadata.max.age.ms</code> (default: 5 minutes). Then describe the Consumer Group <code>test-consumer-group</code> again. What has changed?</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-groups \
    --bootstrap-server kafka-1:19092,kafka-2:29092 \
    --group test-consumer-group \
    --describe</strong></pre>
</div>
</div>
</li>
<li>
<p>In Control Center, view the <code>grow-topic</code> topic configuration from the <code>Topics</code> view. You may need to refresh your browser:</p>
<div class="imageblock">
<div class="content">
<img src="./images/optimizing/c3-grow-topic-after.png" alt="c3 grow topic after">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You need to scroll the list of partitions to see all partitions.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the terminal window where the Consumer is running, press <code>Ctrl+C</code> to terminate the process.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_based_offset_storage">Kafka-based Offset Storage</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start the console Producer for Topic <code>new-topic</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer \
    --bootstrap-server kafka-1:19092,kafka-2:29092 \
    --topic new-topic</strong></pre>
</div>
</div>
<div class="paragraph">
<p>At the <code>&gt;</code> prompt, type some messages into the console. After the first message, you will see a warning message because the Topic <code>new-topic</code> did not exist prior to producing to the Topic. Press <code>Ctrl+D</code> to return to the command line when you are done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; <strong>I</strong>
[2018-08-02 14:01:26,083] WARN [Producer clientId=console-producer] Error while fetching metadata with correlation id 2 : {new-topic=LEADER_NOT_AVAILABLE} (org.apache.kafka.clients.NetworkClient)
&gt; <strong>Love</strong>
&gt; <strong>Kafka</strong>
<strong>&lt;Ctrl+D&gt;</strong></pre>
</div>
</div>
</li>
<li>
<p>Start the console Consumer for Topic <code>__consumer_offsets</code> to view the offsets. Leave this running for the duration of the exercise:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --topic __consumer_offsets \
    --bootstrap-server kafka-1:19092,kafka-2:29092 \
    --formatter "kafka.coordinator.group.GroupMetadataManager\$OffsetsMessageFormatter" \
    | grep new-topic</strong></pre>
</div>
</div>
</li>
<li>
<p>Start the console Consumer in a new terminal window for Topic <code>new-topic</code> in a Consumer Group called <code>new-group</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --from-beginning \
    --topic new-topic \
    --group new-group \
    --bootstrap-server kafka-1:19092,kafka-2:29092</strong>
I
Love
Kafka</pre>
</div>
</div>
</li>
<li>
<p>Press <code>Ctrl+C</code> to terminate the Consumer once your messages have been displayed.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>When reading from the Topic <code>new-topic</code>, did you see the messages you typed earlier?</p>
</li>
<li>
<p>In the other terminal window where you were reading from the Topic <code>__consumer_offsets</code>, did you see any <code>OffsetMetadata</code> specifically for the Topic <code>new-topic</code> such as shown below?</p>
<div class="listingblock">
<div class="content">
<pre>[new-group,new-topic,0]::OffsetAndMetadata(offset=3, leaderEpoch=Optional[0], metadata=, commitTimestamp=1563289258184, expireTimestamp=None)
[new-group,new-topic,0]::OffsetAndMetadata(offset=3, leaderEpoch=Optional[0], metadata=, commitTimestamp=1563289263184, expireTimestamp=None)
...</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If they are currently running, terminate the Producer and Consumers with <code>Ctrl+C</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_performance_tuning">c. Performance Tuning</h3>
<div class="paragraph">
<p>In this exercise, you will observe Kafka performance and use some of Kafkaâs settings to monitor and optimize Consumers.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_9">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Make sure your Kafka cluster is started, <strong>otherwise</strong> execute this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_observing_replica_fetch_times">Observing Replica Fetch Times</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to Control Center. If necessary, open a browser tab to the URL <code><a href="http://localhost:9021" class="bare">http://localhost:9021</a></code>.</p>
</li>
<li>
<p>In the Control Center, go to <code>Cluster 1</code> &#8594; <code>Brokers</code> &#8594; <code>Consumption</code>. Click on one of the lines in the consumption request latency line graph to open the breakdown of times in the request latency lifecycle.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-fetch-latency-1.png" alt="c3 fetch latency 1">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Your exact view may differ.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the fetch request latency breakdown, select the <strong>95th %ile</strong> view.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-fetch-latency-2.png" alt="c3 fetch latency 2">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that percentiles don&#8217;t add associatively, so the numbers around the circle won&#8217;t generally add up to the overall request time percentile.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Observe that most of the fetch request time is in <code>Response remote</code> time waiting for the <code>replica.fetch.wait.max.ms</code> timeout. When Producers are not writing records, the fetch request latency will go up to <code>replica.fetch.wait.max.ms</code> (default 500ms).</p>
</li>
<li>
<p>Create a new Topic called <code>fetch-request</code> with six Partitions and three replicas:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic fetch-request \
    --partitions 6 \
    --replication-factor 3</strong></pre>
</div>
</div>
</li>
<li>
<p>Produce some data to send to the Topic <code>fetch-request</code> and let it run:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-producer-perf-test \
    --topic fetch-request \
    --num-records 1000000 --record-size 100 --throughput 1000 \
    --producer-props bootstrap.servers=kafka-1:19092,kafka-2:29092</strong>

4988 records sent, 997.6 records/sec (0.10 MB/sec), 19.3 ms avg latency, 278.0 max latency.
5004 records sent, 999.2 records/sec (0.10 MB/sec), 10.5 ms avg latency, 83.0 max latency.
5028 records sent, 1005.4 records/sec (0.10 MB/sec), 12.6 ms avg latency, 123.0 max latency.
...</pre>
</div>
</div>
</li>
<li>
<p>Let the producer run for five minutes. In Control Center&#8217;s fetch request latency breakdown, observe that the <strong>response remote time</strong> at the <code>95th %ile</code> drops to a few milliseconds:</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-fetch-latency-3.png" alt="c3 fetch latency 3">
</div>
</div>
</li>
<li>
<p>If it is currently running, terminate the Producer by pressing <code>Ctrl+C</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_tune_consumers_to_decrease_broker_cpu_load">Tune Consumers to Decrease Broker CPU Load</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Topic called <code>i-love-logs</code> with one Partition and one replica.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic i-love-logs \
    --replica-assignment 101</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We are using the <code>--replica-assignment</code> parameter to insure that the partition for all students is located on the <code>kafka-1</code> broker which is assigned broker id <code>101</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Produce some data to send to the Topic <code>i-love-logs</code>. Leave this process running until instructed to end it.</p>
<div class="paragraph">
<p>The following command line sends 10 million messages, 100 bytes in size, at a rate of 1000 messages/sec. The <code>NS</code> environment variable defines interceptors that enable stream monitoring in Control Center.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>NS=io.confluent.monitoring.clients.interceptor &amp;&amp; \
kafka-producer-perf-test \
    --topic i-love-logs \
    --num-records 10000000 \
    --record-size 100 \
    --throughput 1000 \
    --producer-props \
        bootstrap.servers=kafka-1:19092,kafka-2:29092 \
        interceptor.classes=${NS}.MonitoringProducerInterceptor</strong>

5001 records sent, 1000.0 records/sec (0.10 MB/sec), 7.9 ms avg latency, 371.0 max latency.
5004 records sent, 1000.6 records/sec (0.10 MB/sec), 1.4 ms avg latency, 31.0 max latency.
5000 records sent, 1000.0 records/sec (0.10 MB/sec), 1.2 ms avg latency, 7.0 max latency.
...</pre>
</div>
</div>
</li>
<li>
<p>Wait for a few minutes. Go to <code>Cluster 1</code> &#8594; <code>Brokers</code> &#8594; <code>Production</code> in Control Center. If necessary, adjust the timescale of the data to the last 30 minutes.</p>
</li>
<li>
<p>Select <code>broker.id 101</code> in the <strong>Filter brokers</strong> list.</p>
</li>
<li>
<p>Observe changes that occur in the <code>Throughput</code> and <code>Request latency</code>. After five minutes, the graphs should look similar to this:</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-perf-1.png" alt="c3 perf 1">
</div>
</div>
</li>
<li>
<p>Open a new terminal and navigate to the <code>~/confluent-admin</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong></pre>
</div>
</div>
</li>
<li>
<p>Create a consumer properties file called <code>data/consumer.properties</code> that will enable Control Center to monitor Consumer performance of Consumer Group <code>cg</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>PACKAGE=io.confluent.monitoring.clients.interceptor &amp;&amp; \
echo "interceptor.classes=${PACKAGE}.MonitoringConsumerInterceptor" \
    &gt; data/consumer.properties</strong></pre>
</div>
</div>
</li>
<li>
<p>Consume some data from the Topic <code>i-love-logs</code> with Consumer Group <code>cg</code>.<br>
Leave this process running until instructed to end it.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-perf-test \
        --bootstrap-server kafka-1:19092,kafka-2:29092 \
        --topic i-love-logs \
        --group cg \
        --messages 10000000 \
        --threads 1 \
        --show-detailed-stats \
        --reporting-interval 5000 \
        --consumer.config data/consumer.properties</strong>

time, threadId, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec
2018-08-06 12:24:33:271, 0, 26.2823, 5.2554, 275590, 55106.9786, 3072, 1929, 13.6248, 142866.7703
2018-08-06 12:24:38:271, 0, 118.8769, 18.5189, 1246515, 194185.0000, 0, 5000, 18.5189, 194185.0000
2018-08-06 12:24:43:274, 0, 218.6112, 19.9349, 2292305, 209032.5805, 0, 5003, 19.9349, 209032.5805
...</pre>
</div>
</div>
</li>
<li>
<p>In a new terminal, observe the CPU load for the <code>java</code> process on Broker <code>kafka-1</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose exec kafka-1 top -n10</strong>
top - 14:09:16 up 13 min,  0 users,  load average: 5.75, 7.06, 3.90
Tasks:   2 total,   1 running,   1 sleeping,   0 stopped,   0 zombie
%Cpu(s): 65.8 us, 24.6 sy,  0.0 ni,  5.7 id,  0.3 wa,  0.0 hi,  3.5 si,  0.0 st
MiB Mem :   9992.6 total,   2216.4 free,   5589.9 used,   2186.3 buff/cache
MiB Swap:      0.0 total,      0.0 free,      0.0 used.   4043.0 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
    1 appuser   20   0 8398896 486448  21392 S  39.3   4.8   1:43.24 java
  169 appuser   20   0   50284   4104   3516 R   0.0   0.0   0:00.39 top</pre>
</div>
</div>
<div class="paragraph">
<p>Observe CPU utilization until <code>top</code> exits. In the output above, the java process CPU load is 39.3%.</p>
</div>
</li>
<li>
<p>Go to the terminal with the Consumer Group called <code>cg</code> and kill it with <code>Ctrl+C</code>.</p>
</li>
<li>
<p>Add consumer setting <code>fetch.min.bytes=10485760</code> to <code>data/consumer.properties</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>PACKAGE=io.confluent.monitoring.clients.interceptor &amp;&amp; \
echo "interceptor.classes=${PACKAGE}.MonitoringConsumerInterceptor" \
    &gt; data/consumer.properties &amp;&amp; \
echo "fetch.min.bytes=10485760" &gt;&gt; data/consumer.properties</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration tells the Broker to wait for larger amounts of data to accumulate before responding to the Consumer. This generally improves throughput and reduces load on the Broker but can increase latency.</p>
</div>
</li>
<li>
<p>Continue consuming data from for the Topic <code>i-love-logs</code> with Consumer Group <code>cg</code> using the updated <code>consumer.properties</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-perf-test \
        --bootstrap-server kafka-1:19092,kafka-2:29092 \
        --topic i-love-logs \
        --group cg \
        --messages 10000000 \
        --threads 1 \
        --show-detailed-stats \
        --reporting-interval 5000 \
        --consumer.config data/consumer.properties</strong></pre>
</div>
</div>
</li>
<li>
<p>In a different terminal from the one running the <code>cg</code> Consumer Group, observe the CPU load again for the <code>java</code> process on Broker <code>kafka-1</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose exec kafka-1 top -n10</strong>
Tasks:   2 total,   1 running,   1 sleeping,   0 stopped,   0 zombie
%Cpu(s): 20.9 us,  8.2 sy,  0.0 ni, 69.5 id,  0.0 wa,  0.0 hi,  1.4 si,  0.0 st
MiB Mem :   9992.6 total,   2091.8 free,   5641.2 used,   2259.6 buff/cache
MiB Swap:      0.0 total,      0.0 free,      0.0 used.   3990.9 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
    1 appuser   20   0 8398896 501376  21660 S  12.3   4.9   2:35.39 java
  174 appuser   20   0   50284   4144   3560 R   0.0   0.0   0:00.31 top</pre>
</div>
</div>
<div class="paragraph">
<p>Indeed, increasing <code>fetch.min.bytes</code> reduces the CPU load of the Broker.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_defining_over_consumption_trigger_and_action">Defining Over Consumption Trigger and Action</h4>
<div class="paragraph">
<p>For this exercise, we need to define a trigger and corresponding action in Control Center:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Control Center</p>
</li>
<li>
<p>Click the bell icon to get to <strong>Alerts</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="./images/optimizing/c3-alert-area.png" alt="c3 alert area">
</div>
</div>
</li>
<li>
<p>Select the <strong>Triggers</strong> tab</p>
</li>
<li>
<p>Click the button <strong>New trigger</strong></p>
</li>
<li>
<p>Complete the dialog using the following settings:</p>
<table class="tableblock frame-all grid-all stripes-even" style="width: 50%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Over Consumption</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumer group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumer group name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cg &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumption difference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buffer (seconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-overconsumption-trigger.png" alt="c3 overconsumption trigger" width="500">
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>In the confirmation box, when asked to "Set actions to perform when your trigger goes off", select <strong>Create an action</strong></p>
</li>
<li>
<p>Complete the dialog using the following settings:</p>
<table class="tableblock frame-all grid-all stripes-even" style="width: 50%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Over Consumption</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Over Consumption</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Over Consumption</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max send rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 Per hour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recipient email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:anyone@anywhere.com">anyone@anywhere.com</a></p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-action.png" alt="c3 action" width="500">
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_simulating_over_consumption">Simulating Over Consumption</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the terminal with the Consumer Group called <code>cg</code> and kill it with <code>Ctrl+C</code>.</p>
</li>
<li>
<p>Identify the current offsets of Consumer Group <code>cg</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-groups \
        --bootstrap-server kafka-1:19092,kafka-2:29092 \
        --group cg \
        --describe</strong>

Consumer group 'cg' has no active members.

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
cg              i-love-logs     0          671615          689170          17555           -               -               -</pre>
</div>
</div>
</li>
<li>
<p>Reset the offsets of Consumer Group <code>cg</code> offset for Partition <code>0</code> of Topic <code>i-log-logs</code> to <code>&lt;current offset&gt; - 100</code>. Using the previous step as an example, this would be, <code>671615 - 100 = 671515</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-groups \
    --bootstrap-server kafka-1:19092,kafka-2:29092 \
    --group cg \
    --reset-offsets \
    --to-offset &lt;value&gt; \
    --topic i-love-logs:0 \
    --execute</strong>

GROUP                          TOPIC                          PARTITION  NEW-OFFSET
cg                             i-love-logs                    0          671515</pre>
</div>
</div>
</li>
<li>
<p>Continue consuming data from for the Topic <code>i-love-logs</code> with Consumer Group <code>cg</code>. Since the offsets have been reset to <code>&lt;current offset&gt; - 100</code>, the Consumer Group will consume <code>100</code> messages from the <code>i-love-logs</code> Topic a second time, thereby processing these messages again. This is a good simulation of Consumer Group over-consumption:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-perf-test \
        --bootstrap-server kafka-1:19092,kafka-2:29092 \
        --topic i-love-logs \
        --group cg \
        --messages 10000000 \
        --threads 1 \
        --show-detailed-stats \
        --reporting-interval 5000 \
        --consumer.config data/consumer.properties</strong></pre>
</div>
</div>
</li>
<li>
<p>Observe the cluster in Control Center for a couple minutes. You may need to adjust your time window.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to <code>Cluster 1</code> &#8594; <code>Consumers</code> &#8594; <code>cg</code> &#8594; <code>Consumption</code> and observe the Consumer Group <code>cg</code> for a few minutes:</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-overconsumption-after.png" alt="c3 overconsumption after">
</div>
</div>
<div class="paragraph">
<p>Observe that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>% messages consumed</code> is over 100%</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click the bell icon to go back to the <code>Alerts Overview</code>. View the alert history and notice that the over-consumption event triggered an alert. It is critical to monitor applications for message consumption to know how your applications are behaving. Over-consumption may happen intentionally, or it may happen unintentionally, for example if an application crashes before committing processed messages.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/optimizing/c3-alert.png" alt="c3 alert">
</div>
</div>
</li>
<li>
<p>End all running Producers and Consumers by going to the respective terminal window and pressing <code>Ctrl+C</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_06_kafka_security">Lab 06 Kafka Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_securing_the_kafka_cluster">a. Securing the Kafka Cluster</h3>
<div class="paragraph">
<p>In this exercise, you will configure one-way SSL authentication, two-way SSL authentication, and explore the SSL performance impact.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_10">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>If a cluster is currently running, use <code>docker-compose down</code> to shut it down.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose down -v</strong></pre>
</div>
</div>
</li>
<li>
<p>Change directory to the <code>secure-cluster</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin/secure-cluster</strong></pre>
</div>
</div>
</li>
<li>
<p>Start the secure cluster:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The broker containers have been configured to wait until their respective <code>kafka-n-creds</code> directory has been populated with the required certs. Once the certs are present, the broker startup continues. These certs are being created in the next step of the exercise.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_generating_certificates">Generating Certificates</h4>
<div class="paragraph">
<p>Next, we generate all the necessary certificates and credentials that are used to create a secure, 3-Broker Kafka cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a signed certificate, keystores, and truststores by running a script:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>./certs-create.sh</strong></pre>
</div>
</div>
</li>
<li>
<p>Use VScode or other editor to inspect the files the script created:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>code .</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ca.key</code> file is the private key that the Certificate Authority uses to sign the certificate <code>ca.crt</code>. The script used this certificate to create the Broker keystore and the client truststore. The Broker&#8217;s keystore is what the Broker uses to send its certificate to the client. The client truststore is what the client uses to check whether a Broker&#8217;s certificate ought to be trusted&#8201;&#8212;&#8201;if the checksum of the received certificate is unexpected, then someone tried to alter the certificate and thus the certificate is untrustworthy.</p>
</div>
<div class="paragraph">
<p>Later during mutual SSL, the client will also need to authenticate with the Broker. Therefore, the script also created a keystore for the client and a truststore for the Broker.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_ssl_on_the_brokers">Enabling SSL on the Brokers</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the file <code>~/confluent-admin/secure-cluster/docker-compose.yml</code> in your editor and note the following environment variables (in addition to the existing ones) that have been added to each of the three Brokers (<code>kafka-1</code>, <code>kafka-2</code> and <code>kafka-3</code>), e.g. for <code>kafka-1</code> they are:</p>
<div class="listingblock">
<div class="content">
<pre>KAFKA_ADVERTISED_LISTENERS: SSL://kafka-1:19093,PLAINTEXT://kafka-1:19092,DOCKER://kafka-1:9092
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,SSL:SSL,DOCKER:PLAINTEXT
KAFKA_SSL_KEYSTORE_FILENAME: kafka.kafka-1.keystore.jks
KAFKA_SSL_KEYSTORE_CREDENTIALS: kafka-1_keystore_creds
KAFKA_SSL_KEY_CREDENTIALS: kafka-1_sslkey_creds
KAFKA_SSL_TRUSTSTORE_FILENAME: kafka.kafka-1.truststore.jks
KAFKA_SSL_TRUSTSTORE_CREDENTIALS: kafka-1_truststore_creds
KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: "HTTPS"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The variable names shown above might not look familiar at first. Your trainer has shown you variable names in the configuration files for Brokers such as <code>ssl.keystore.filename</code> or <code>ssl.truststore.credentials</code>. A startup script inside each container converts the environment variable names by a standard algorithm into the Kafka specific variable names and adds them to the respective configuration file. Upper case is converted to lowercase and underscores are converted to periods. Furthermore each component (Kafka, REST Proxy, Kafka Connect, etc.) has a well defined prefix that is removed from the Docker variable. In the above case it is <code>KAFKA_</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Each of the three Brokers maps the credential folder into <code>/etc/kafka/secrets</code>. For example, <code>kafka-1</code> has:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">volumes</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">- $PWD/kafka-1-creds:/etc/kafka/secrets</span></code></pre>
</div>
</div>
</li>
<li>
<p>Please answer the following questions. Feel free to discuss with peers:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Why is <code>KAFKA_ADVERTISED_LISTENERS</code> configured for both <code>SSL</code> and <code>PLAINTEXT</code>?</p>
</li>
<li>
<p>What would happen if <code>KAFKA_ADVERTISED_LISTENERS</code> were configured for just <code>SSL</code>?</p>
</li>
<li>
<p>What does <code>KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM</code> do?</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_verifying_ssl_is_working">Verifying SSL is Working</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From a terminal window verify that the keystore and truststore of each Broker are setup properly. The <code>openssl</code> command below should return a key and certificate:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>openssl s_client -connect kafka-1:19093 -tls1_2</strong>
CONNECTED(00000005)
depth=1 CN = ca1.test.confluent.io, OU = TEST, O = CONFLUENT, L = PaloAlto, C = US
verify error:num=19:self signed certificate in certificate chain
---
Certificate chain
 0 s:C = US, ST = Ca, L = PaloAlto, O = CONFLUENT, OU = TEST, CN = kafka-1
   i:CN = ca1.test.confluent.io, OU = TEST, O = CONFLUENT, L = PaloAlto, C = US
 1 s:CN = ca1.test.confluent.io, OU = TEST, O = CONFLUENT, L = PaloAlto, C = US
   i:CN = ca1.test.confluent.io, OU = TEST, O = CONFLUENT, L = PaloAlto, C = US
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIDTDCCAjQCFAlRToiRQJ+ipSaIZ1efStGSFbUVMA0GCSqGSIb3DQEBCwUAMGMx
HjAcBgNVBAMMFWNhMS50ZXN0LmNvbmZsdWVudC5pbzENMAsGA1UECwwEVEVTVDES
MBAGA1UECgwJQ09ORkxVRU5UMREwDwYDVQQHDAhQYWxvQWx0bzELMAkGA1UEBhMC
...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The error in the 3rd line of output is expected since there are self-signed certificates during the certificate creation process. Press <code>Ctrl+C</code> to stop the above command.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Repeat the same for the other two Brokers:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>openssl s_client -connect kafka-2:29093 -tls1_2</strong>
$ <strong>openssl s_client -connect kafka-3:39093 -tls1_2</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you see a <code>Connection refused</code> error, then the Broker is not properly set up for SSL or may need to be restarted with <code>docker-compose restart &lt;broker&gt;</code>. We simulate this error here by providing the wrong port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>openssl s_client -connect kafka-1:9094 -tls1_2</strong>
140067608003008:error:0200206F:system library:connect:Connection refused:../crypto/bio/b_sock2.c:110:
140067608003008:error:2008A067:BIO routines:BIO_connect:connect error:../crypto/bio/b_sock2.c:111:
connect:errno=111</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Let&#8217;s try to produce messages to the cluster via the SSL port.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a new Topic called <code>ssl-topic</code> with one Partition and three replicas:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic ssl-topic \
    --partitions 1 \
    --replication-factor 3</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Admin Client is using the PLAINTEXT listener at port 19092 to create the Topic.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the console Producer for Topic <code>ssl-topic</code>. Here the client is connecting to the SSL port <code>19093</code> rather than the PLAINTEXT port <code>19092</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer \
    --bootstrap-server kafka-1:19093,kafka-2:29093 \
    --topic ssl-topic</strong>
&gt;[2020-10-29 18:30:25,757] WARN [Producer clientId=console-producer] Bootstrap broker kafka-1:19093 (id: -1 rack: null) disconnected (org.apache.kafka.clients.NetworkClient)
[2020-10-29 18:30:26,066] WARN [Producer clientId=console-producer] Bootstrap broker kafka-2:29093 (id: -2 rack: null) disconnected (org.apache.kafka.clients.NetworkClient)</pre>
</div>
</div>
</li>
<li>
<p>Press <code>Ctrl+C</code> to stop the producer.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This leads to a connection error. Why?</p>
</div>
<div class="paragraph">
<p>When clients communicate with Kafka brokers using SSL, we must provide the required configuration settings.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>We will now configure the Kafka clients to use the truststore.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>First, let&#8217;s examine the <code>client-ssl.properties</code> file that we need to specify when we run the <code>kafka-console-producer and kafka-console-consumer</code> clients when connecting to the broker using SSL:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cat client-creds/client_ssl.properties</strong>
security.protocol=SSL
ssl.truststore.location=client-creds/kafka.client.truststore.jks
ssl.truststore.password=confluent</pre>
</div>
</div>
</li>
<li>
<p>Try to produce messages again using the <code>client_ssl.properties</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer \
    --bootstrap-server kafka-1:19093,kafka-2:29093 \
    --topic ssl-topic \
    --producer.config client-creds/client_ssl.properties</strong></pre>
</div>
</div>
</li>
<li>
<p>At the <code>&gt;</code> prompt, type âSecurity is goodâ and press Enter. Add a couple more messages and then press <code>Ctrl+D</code> to exit the console Producer.</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Security is good
&gt; Certificates
&gt; Keys
<strong>&lt;Ctrl+D&gt;</strong></pre>
</div>
</div>
</li>
<li>
<p>Start the console Consumer for Topic <code>ssl-topic</code> using the <code>client_ssl.properties</code> file. You should see the messages you typed above. Press <code>Ctrl+C</code> once your messages have been displayed.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --consumer.config client-creds/client_ssl.properties \
    --from-beginning \
    --topic ssl-topic \
    --bootstrap-server kafka-1:19093,kafka-2:29093</strong>

Security is good
Certificates
Keys</pre>
</div>
</div>
<div class="paragraph">
<p>Press <code>Ctrl+C</code> to stop the Consumer.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_mutual_ssl_authentication">Enabling Mutual SSL Authentication</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>docker-compose.yml</code> file in folder <code>~/confluent-admin/secure-cluster</code>, uncomment the following environment variable for each Broker:</p>
<div class="literalblock">
<div class="content">
<pre>KAFKA_SSL_CLIENT_AUTH: "required"</pre>
</div>
</div>
</li>
<li>
<p>Restart all 3 Brokers by executing:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin/secure-cluster</strong>
$ <strong>docker-compose up -d</strong>

zk-1 is up-to-date
control-center is up-to-date
schema-registry is up-to-date
zk-3 is up-to-date
Recreating kafka-2 ...
secure-cluster_base_1 is up-to-date
Recreating kafka-2 ... done
Recreating kafka-1 ... done
Recreating kafka-3 ... done</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Docker will realize that the definition of the 3 Broker definitions have changed and reschedule the respective container.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Try to run the <code>kafka-console-consumer</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --consumer.config client-creds/client_ssl.properties \
    --from-beginning \
    --topic ssl-topic \
    --bootstrap-server kafka-1:19093,kafka-2:29093</strong>
[2020-10-29 18:47:01,995] ERROR [Consumer clientId=consumer-console-consumer-86926-1, groupId=console-consumer-86926] Connection to node -2 (kafka-2/127.0.0.1:29093) failed authentication due to: Failed to process post-handshake messages (org.apache.kafka.clients.NetworkClient)
...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This fails with a Java IO Exception. Why?</p>
</div>
<div class="paragraph">
<p>Previously, the Broker had to authenticate with the Clients. Now that we configured the Brokers to require mutual SSL, the Clients must also authenticate with Brokers.</p>
</div>
<div class="paragraph">
<p>The <code>certs-create.sh</code> script already created a keystore in the <code>client-creds</code> folder and corresponding truststore in each <code>kafka-{1|2|3}-creds</code> folders. We need to add the related keystore configuration settings to <code>client_ssl.properties</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add the required lines to <code>client_ssl.properties</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>echo "ssl.keystore.location=client-creds/kafka.client.keystore.jks" &gt;&gt; client-creds/client_ssl.properties &amp;&amp; \
echo "ssl.keystore.password=confluent" &gt;&gt; client-creds/client_ssl.properties</strong></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Let&#8217;s confirm <code>client-ssl.properties</code> now contains all of the required settings:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cat client-creds/client_ssl.properties</strong>
security.protocol=SSL
ssl.truststore.location=client-creds/kafka.client.truststore.jks
ssl.truststore.password=confluent
ssl.keystore.location=client-creds/kafka.client.keystore.jks
ssl.keystore.password=confluent</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Start the console Consumer for Topic <code>ssl-topic</code> again, this time passing in the updated <code>client_ssl.properties</code> file. Now it should succeed and you should see the messages you typed earlier:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin/secure-cluster</strong>
$ <strong>kafka-console-consumer \
    --consumer.config client-creds/client_ssl.properties \
    --from-beginning \
    --topic ssl-topic \
    --bootstrap-server kafka-1:19093,kafka-2:29093</strong>

Security is good
Certificates
Keys</pre>
</div>
</div>
<div class="paragraph">
<p>Press <code>Ctrl+C</code> to quit the Consumer once your messages have been displayed.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_performance_impact">SSL Performance Impact</h4>
<div class="paragraph">
<p>In this section, you will run two performance tests and compare the results:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connecting to the cluster with no SSL via the configured <code>PLAINTEXT</code> port (19092/29092)</p>
</li>
<li>
<p>Connecting to the cluster with SSL via the configured <code>SSL</code> port (19093/29093)</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Create a new Topic called <code>no-ssl-topic</code> with one Partition and three replicas.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-2:29092 \
    --create \
    --topic no-ssl-topic \
    --partitions 1 \
    --replication-factor 3</strong></pre>
</div>
</div>
</li>
<li>
<p>Produce a high rate of data to Topic <code>no-ssl-topic</code> without SSL. Notice that the Broker port numbers used below are <code>19092/29092</code>, the PLAINTEXT port.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-producer-perf-test \
    --topic no-ssl-topic \
    --num-records 400000 \
    --record-size 1000 \
    --throughput 1000000 \
    --producer-props bootstrap.servers=kafka-1:19092,kafka-2:29092</strong>
56833 records sent, 11366.6 records/sec (10.84 MB/sec), 1930.7 ms avg latency, 2817.0 ms max latency.
67152 records sent, 13427.7 records/sec (12.81 MB/sec), 2373.1 ms avg latency, 2607.0 ms max latency.
138640 records sent, 27728.0 records/sec (26.44 MB/sec), 1374.8 ms avg latency, 2488.0 ms max latency.
400000 records sent, 21917.808219 records/sec (<strong>20.90 MB/sec</strong>), 1416.54 ms avg latency, 2817.00 ms max latency, 1072 ms 50th, 2523 ms 95th, 2688 ms 99th, 2802 ms 99.9th.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Performance results will vary.
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>What is the average throughput? Look in the last line for the value associated with <code>MB/sec</code>.</p>
</li>
<li>
<p>What is the average latency? Look in the last line for the value associated with <code>ms avg latency</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Now produce a high rate of data to Topic <code>ssl-topic</code> with SSL. Notice that you now connect to Broker port number <code>9093</code>, the SSL port.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-producer-perf-test \
    --topic ssl-topic \
    --num-records 400000 \
    --record-size 1000 \
    --throughput 1000000 \
    --producer-props bootstrap.servers=kafka-1:19093,kafka-2:29093 \
    --producer.config client-creds/client_ssl.properties</strong>
35537 records sent, 7107.4 records/sec (6.78 MB/sec), 2440.7 ms avg latency, 3680.0 ms max latency.
63904 records sent, 12780.8 records/sec (12.19 MB/sec), 2711.9 ms avg latency, 3182.0 ms max latency.
110768 records sent, 22153.6 records/sec (21.13 MB/sec), 1662.3 ms avg latency, 2517.0 ms max latency.
179744 records sent, 35948.8 records/sec (34.28 MB/sec), 937.6 ms avg latency, 1227.0 ms max latency.
400000 records sent, 19688.915141 records/sec (<strong>18.78 MB/sec</strong>), 1555.90 ms avg latency, 3680.00 ms max latency, 1216 ms 50th, 3099 ms 95th, 3442 ms 99th, 3658 ms 99.9th.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Performance results will vary.
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>What is the average throughput? Look in the last line for the value associated with <code>MB/sec</code>. Is this higher or lower than without SSL?</p>
</li>
<li>
<p>What is the average latency? Look for the value associated with <code>ms avg latency</code>. Is this higher or lower than without SSL?</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_4">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute the following command to completely cleanup your environment:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin/secure-cluster</strong>
$ <strong>docker-compose down -v</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_07_data_pipelines_with_kafka_connect">Lab 07 Data Pipelines with Kafka Connect</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_running_kafka_connect">a. Running Kafka Connect</h3>
<div class="paragraph">
<p>In this exercise, you will run Connect in distributed mode, and use the JDBC source Connector and File sink Connector. You will configure monitors using the REST API as well as the Control Center UI. You will use Control Center to monitor the connectors as well.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_11">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure you have prepared your environment by following &#8594; <a href="#preparing-lab">Preparing the Labs</a></p>
</li>
<li>
<p>Start the Kafka cluster:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>docker-compose up -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_connect_pipeline">Connect Pipeline</h4>
<div class="paragraph">
<p>In this section, you will run Connect in distributed mode with two Connectors: a JDBC source Connector and a file sink Connector. The JDBC source Connector writes the contents of a database table to a Kafka Topic. The file sink Connector reads data from the same Kafka Topic and writes those messages to a file. It will update when new rows are added to the database.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/kafka-connect/connect_pipeline.jpg" alt="connect pipeline" width="700">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_12">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the SQLite database <code>my.db</code> in the folder <code>~/confluent-admin/data</code>:  (You may have to install SQLite -  $  sudo apt install sqlite3 )</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong>
$ <strong>sqlite3 data/my.db</strong></pre>
</div>
</div>
</li>
<li>
<p>Run the following statements in SQLite3&gt; :</p>
<div class="listingblock">
<div class="content">
<pre><strong>create table years(id INTEGER PRIMARY KEY AUTOINCREMENT, name VARCHAR(50), year INTEGER);</strong>
<strong>insert into years(name,year) values('Hamlet',1600);</strong>
<strong>insert into years(name,year) values('Julius Caesar',1599);</strong>
<strong>insert into years(name,year) values('Macbeth',1605);</strong>
<strong>insert into years(name,year) values('Merchant of Venice',1595);</strong>
<strong>insert into years(name,year) values('Othello',1604);</strong>
<strong>insert into years(name,year) values('Romeo and Juliette',1594);</strong>
<strong>insert into years(name,year) values('Anthony and Cleopatra',1606);</strong></pre>
</div>
</div>
</li>
<li>
<p>Make sure the data is there:</p>
<div class="listingblock">
<div class="content">
<pre>sqlite&gt; <strong>SELECT * FROM years;</strong>

1|Hamlet|1600
2|Julius Caesar|1599
3|Macbeth|1605
4|Merchant of Venice|1595
5|Othello|1604
6|Romeo and Juliette|1594
7|Anthony and Cleopatra|1606</pre>
</div>
</div>
</li>
<li>
<p>Press <code>Ctrl+D</code> to exit SQLite3.</p>
</li>
<li>
<p>Create a new Topic called <code>shakespeare_years</code> with one Partition and one replica.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --create \
    --topic shakespeare_years \
    --partitions 1 \
    --replication-factor 1</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="install-jdbc-connector">Install the Kafka Connect JDBC Connector</h4>
<div class="paragraph">
<p>We use the Kafka Connect JDBC connector in this exercise so we need to install it on the worker.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the connector:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose exec -u root connect confluent-hub install confluentinc/kafka-connect-jdbc:10.0.0</strong>
The component can be installed in any of the following Confluent Platform installations:
  1. / (installed rpm/deb package)
  2. / (where this tool is installed)
Choose one of these to continue the installation (1-2):</pre>
</div>
</div>
</li>
<li>
<p>Type <code>1</code> and press <strong>Enter</strong>.</p>
</li>
<li>
<p>At the prompt, type <code>N</code> and press <strong>Enter</strong>.</p>
<div class="listingblock">
<div class="content">
<pre>Do you want to install this into /usr/share/confluent-hub-components? (yN)</pre>
</div>
</div>
</li>
<li>
<p>At the prompt, type <code>/usr/share/java/kafka</code> and press <strong>Enter</strong>.</p>
<div class="listingblock">
<div class="content">
<pre>Specify installation directory:</pre>
</div>
</div>
</li>
<li>
<p>At the prompt, type <code>y</code> and press <strong>Enter</strong>.</p>
<div class="listingblock">
<div class="content">
<pre>Component's license:
Confluent Community License
https://www.confluent.io/confluent-community-license
I agree to the software license agreement (yN)</pre>
</div>
</div>
</li>
<li>
<p>At the prompt, type <code>y</code> and press <strong>Enter</strong>.</p>
<div class="listingblock">
<div class="content">
<pre>Downloading component Kafka Connect JDBC 10.0.0, provided by Confluent, Inc. from Confluent Hub and installing into /usr/share/java/kafka
Detected Worker's configs:
  1. Standard: /etc/kafka/connect-distributed.properties
  2. Standard: /etc/kafka/connect-standalone.properties
  3. Standard: /etc/schema-registry/connect-avro-distributed.properties
  4. Standard: /etc/schema-registry/connect-avro-standalone.properties
  5. Used by Connect process with PID : /etc/kafka-connect/kafka-connect.properties
Do you want to update all detected configs? (yN)</pre>
</div>
</div>
<div class="paragraph">
<p>The installation completes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Adding installation directory to plugin path in the following files:
  /etc/kafka/connect-distributed.properties
  /etc/kafka/connect-standalone.properties
  /etc/schema-registry/connect-avro-distributed.properties
  /etc/schema-registry/connect-avro-standalone.properties
  /etc/kafka-connect/kafka-connect.properties

Completed</pre>
</div>
</div>
</li>
<li>
<p>To complete the installation, we need to restart the <code>connect</code> container:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose restart connect</strong></pre>
</div>
</div>
</li>
<li>
<p>Verify that the Connect Worker successfully restarted prior to continuing to the next step:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose logs connect | grep -i "INFO .* Finished starting connectors and tasks"</strong>
connect | [2020-10-15 21:40:34,312] INFO [Worker clientId=connect-1, groupId=connect] Finished starting connectors and tasks (org.apache.kafka.connect.runtime.distributed.DistributedHerder:1236)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Repeat this command until the <strong>Finished starting connectors and tasks</strong> message appears.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_source_connector">Configuring the Source Connector</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a new source connector to read data from the database <code>my.db</code> and write to the Kafka Topic <code>shakespeare_years</code> by using the Connect REST API:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open Control Center at <a href="http://localhost:9021" class="bare">http://localhost:9021</a>:</p>
</li>
<li>
<p>In the left sidebar, select <strong>Cluster 1</strong></p>
</li>
<li>
<p>In the sidebar click <strong>Connect</strong></p>
</li>
<li>
<p>In the view <strong>All Connect Clusters</strong> select the (only available) entry <strong>connect-default</strong></p>
</li>
<li>
<p>Click <strong>Add connector</strong></p>
</li>
<li>
<p>In the <strong>Browse</strong> overview select the <strong>JdbcSourceConnector Source</strong> tile</p>
</li>
<li>
<p>Configure the JDBC Source Connector</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the <strong>Name</strong> text box, type <code>JDBC-Source-Connector</code></p>
</li>
<li>
<p>In the <strong>Database</strong> section, in the <strong>JDBC URL</strong> text box, type <code>jdbc:sqlite:/data/my.db</code></p>
</li>
<li>
<p>In the <strong>Database</strong> section, in the <strong>Table Whitelist</strong> dropdown, enter <code>years</code></p>
</li>
<li>
<p>Under section <strong>Mode</strong>, in the <strong>Table Loading Mode</strong> text box, type <code>incrementing</code></p>
</li>
<li>
<p>Under section <strong>Mode</strong>, in the <strong>Incrementing Column Name</strong> text box, type <code>id</code></p>
</li>
<li>
<p>Under section <strong>Connector</strong>, in the <strong>Topic Prefix</strong> text box, type <code>shakespeare_</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Continue</strong></p>
<div class="paragraph">
<p><span class="image"><img src="./images/kafka-connect/c3-connect-add-connector.png" alt="c3 connect add connector"></span></p>
</div>
</li>
<li>
<p>Click <strong>Launch</strong></p>
</li>
<li>
<p>Verify you see the new connector <strong>JDBC-Source-Connector</strong> running</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/kafka-connect/c3-connect-source-running.png" alt="c3 connect source running" width="600">
</div>
</div>
</li>
<li>
<p><strong>Optional</strong>: As an alternative to using Control Center, you could instead add the source connector via command line using Kafka Connect&#8217;s <strong>REST API</strong>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>curl -s -X POST \
      -H "Content-Type: application/json" \
      --data '{
          "name": "JDBC-Source-Connector",
          "config": {
              "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",
              "connection.url": "jdbc:sqlite:/data/my.db",
              "table.whitelist": "years",
              "mode": "incrementing",
              "incrementing.column.name": "id",
              "table.types": "TABLE",
              "topic.prefix": "shakespeare_"
          }
      }' http://connect:8083/connectors</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Launch another terminal and start the console Consumer for Topic <code>shakespeare_years</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-avro-console-consumer \
    --bootstrap-server kafka-1:19092, kafka-2:29092 \
    --property schema.registry.url=http://schema-registry:8081 \
    --from-beginning \
    --topic shakespeare_years</strong>

{"id":1,"name":{"string":"Hamlet"},"year":{"long":1600}}
{"id":2,"name":{"string":"Julius Caesar"},"year":{"long":1599}}
{"id":3,"name":{"string":"Macbeth"},"year":{"long":1605}}
{"id":4,"name":{"string":"Merchant of Venice"},"year":{"long":1595}}
{"id":5,"name":{"string":"Othello"},"year":{"long":1604}}
{"id":6,"name":{"string":"Romeo and Juliette"},"year":{"long":1594}}
{"id":7,"name":{"string":"Anthony and Cleopatra"},"year":{"long":1606}}
...</pre>
</div>
</div>
<div class="paragraph">
<p>Leave the Consumer running until instructed to terminate it. See what messages have been and will be produced.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_sink_connector">Configuring the Sink Connector</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a second terminal window and navigate to the <code>confluent-admin</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin</strong></pre>
</div>
</div>
</li>
<li>
<p>Update permissions for the <code>data</code> directory to allow access by the <code>connect</code> container:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>chmod 777 data</strong></pre>
</div>
</div>
</li>
<li>
<p>Add a new sink connector to read data from the Kafka Topic <code>shakespeare_years</code> and write to the file <code>data/test.sink.txt</code> on the Connect worker system:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>curl -s -X POST \
        -H "Content-Type: application/json" \
        --data '{
            "name": "File-Sink-Connector",
            "config": {
                "topics": "shakespeare_years",
                "connector.class": "org.apache.kafka.connect.file.FileStreamSinkConnector",
                "value.converter": "io.confluent.connect.avro.AvroConverter",
                "value.converter.schema.registry.url": "http://schema-registry:8081",
                "file": "/data/test.sink.txt"
            }
        }' http://connect:8083/connectors</strong></pre>
</div>
</div>
</li>
<li>
<p>Use Control Center to verify the creation of the connector.</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/kafka-connect/c3-connect-sink-running.png" alt="c3 connect sink running" width="500">
</div>
</div>
</li>
<li>
<p>Verify that a new file called <code>test.sink.txt</code> has been created in the folder <code>~/confluent-admin/data</code>. View this file to confirm that the sink connector worked:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cat data/test.sink.txt</strong>

Struct{id=1,name=Hamlet,year=1600}
Struct{id=2,name=Julius Caesar,year=1599}
Struct{id=3,name=Macbeth,year=1605}
Struct{id=4,name=Merchant of Venice,year=1596}
Struct{id=5,name=Othello,year=1604}
Struct{id=6,name=Romeo and Juliet,year=1594}
Struct{id=7,name=Antony and Cleopatra,year=1606}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This file was created by the <strong>File Sink Connector</strong> in folder <code>/data/</code> on the <code>connect</code> container. Since this container folder is mapped to the folder <code>~/confluent-admin/data</code> of your host system, we can see it there too.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Insert a few new rows into the table <code>years</code>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From your host, run SQLite3:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>sqlite3 data/my.db</strong></pre>
</div>
</div>
</li>
<li>
<p>Insert two records:</p>
<div class="listingblock">
<div class="content">
<pre>sqlite&gt; <strong>INSERT INTO years(name,year) VALUES('Tempest',1611);
        INSERT INTO years(name,year) VALUES('King Lear',1605);</strong></pre>
</div>
</div>
</li>
<li>
<p>In the window where the Consumer is still running observe that two new records have been output:</p>
<div class="listingblock">
<div class="content">
<pre>{"id":8,"name":{"string":"Tempest"},"year":{"long":1611}}
{"id":9,"name":{"string":"King Lear"},"year":{"long":1605}}</pre>
</div>
</div>
</li>
<li>
<p>Quit SQLite3 by pressing <code>Ctrl+D</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>View the sink file, <code>test.sink.txt</code> again and notice that the new log lines are added to it:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cat data/test.sink.txt</strong>

Struct{id=1,name=Hamlet,year=1600}
Struct{id=2,name=Julius Caesar,year=1599}
Struct{id=3,name=Macbeth,year=1605}
Struct{id=4,name=Merchant of Venice,year=1596}
Struct{id=5,name=Othello,year=1604}
Struct{id=6,name=Romeo and Juliet,year=1594}
Struct{id=7,name=Antony and Cleopatra,year=1606}
<strong>Struct{id=8,name=Tempest,year=1611}
Struct{id=9,name=King Lear,year=1605}</strong></pre>
</div>
</div>
</li>
<li>
<p>In Control Center, observe the Consumer Group performance for Kafka Connect. You could use this to ensure that Kafka Connect is performing well in your cluster, just like other production traffic.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In Control Center, make sure that you have selected <strong>Cluster 1</strong> and then click on <strong>Consumers</strong></p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/kafka-connect/c3-connect-consumers.png" alt="c3 connect consumers">
</div>
</div>
</li>
<li>
<p>In the list of Consumer Groups select <strong>connect-File-Sink-Connector</strong>. You will then see the <strong>Consumer lag</strong> view</p>
<div class="imageblock text-center">
<div class="content">
<img src="./images/kafka-connect/c3-connect-consumer-lag.png" alt="c3 connect consumer lag">
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In the terminal window where the consumer is running, press <code>Ctrl+C</code> to terminate the process.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_5">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute the following command to completely cleanup your environment. If you wish to preserve the data in the cluster so that you can continue to experiment, omit the <code>-v</code> option.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose down -v</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-reassign-partitions">Appendix A: Reassigning Partitions in a Topic - Alternate Method</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the <strong>Kafka Administrative Tools</strong> exercise, one of the sections uses the Confluent Auto Data Balancer to rebalance the cluster and to reassign Partitions for the Topic <code>moving</code>. If you prefer to use the Apache open source tool <code>kafka-reassign-partitions</code> instead, you may follow the instructions below.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This appendix assumes that the Topic <code>moving</code> exists and has been populated as described in the <strong>Kafka Administrative Tools</strong> exercise. If this is not the case then please first follow the instructions &#8594; <a href="#rebalancing-cluster">Rebalancing the Cluster</a>.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change to the <code>data</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-admin/data</strong></pre>
</div>
</div>
</li>
<li>
<p>In that folder create a file <code>topics-to-move.json</code> as follows:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>echo '{"topics": [{"topic": "moving"}],"version":1}' &gt; topics-to-move.json</strong></pre>
</div>
</div>
</li>
<li>
<p>Generate the reassignment plan.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-reassign-partitions \
    --bootstrap-server kafka-1:19092 \
    --topics-to-move-json-file topics-to-move.json \
    --broker-list "101,102,103" \
    --generate &gt; reassignment.json</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The content of the file <code>reassignment.json</code> should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cat reassignment.json</strong>

Current partition replica assignment
{"version":1,"partitions":[{"topic":"moving","partition":2,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":3,"replicas":[102,101],"log_dirs":["any","any"]},{"topic":"moving","partition":0,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":4,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":5,"replicas":[102,101],"log_dirs":["any","any"]},{"topic":"moving","partition":1,"replicas":[102,101],"log_dirs":["any","any"]}]}

Proposed partition reassignment configuration
{"version":1,"partitions":[{"topic":"moving","partition":2,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":4,"replicas":[103,102],"log_dirs":["any","any"]},{"topic":"moving","partition":1,"replicas":[103,101],"log_dirs":["any","any"]},{"topic":"moving","partition":0,"replicas":[102,103],"log_dirs":["any","any"]},{"topic":"moving","partition":3,"replicas":[102,101],"log_dirs":["any","any"]},{"topic":"moving","partition":5,"replicas":[101,103],"log_dirs":["any","any"]}]}</pre>
</div>
</div>
</li>
<li>
<p>Open the file <code>~/confluent-admin/data/reassignment.json</code> and edit it so it only includes the âProposed partition reassignment configuration" in JSON (i.e., just the last line).</p>
<div class="paragraph">
<p>The resulting file should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cat reassignment.json</strong>

{"version":1,"partitions":[{"topic":"moving","partition":2,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":4,"replicas":[103,102],"log_dirs":["any","any"]},{"topic":"moving","partition":1,"replicas":[103,101],"log_dirs":["any","any"]},{"topic":"moving","partition":0,"replicas":[102,103],"log_dirs":["any","any"]},{"topic":"moving","partition":3,"replicas":[102,101],"log_dirs":["any","any"]},{"topic":"moving","partition":5,"replicas":[101,103],"log_dirs":["any","any"]}]}</pre>
</div>
</div>
</li>
<li>
<p>Observe the current throttling limits configured:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-configs \
    --describe \
    --bootstrap-server kafka-1:19092 \
    --entity-type brokers</strong>
Dynamic configs for broker 101 are:
Dynamic configs for broker 102 are:
Dynamic configs for broker 103 are:
Default configs for brokers in the cluster are:</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>kafka-configs</code> by default only reports dynamic configuration settings. Since none have been set at this time, the dynamic configs list for each broker should be empty.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Execute the reassignment plan with throttling set to 1MBps.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-reassign-partitions \
    --bootstrap-server kafka-1:19092 \
    --reassignment-json-file reassignment.json \
    --execute \
    --throttle 1000000</strong>

Current partition replica assignment

{"version":1,"partitions":[{"topic":"moving","partition":2,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":3,"replicas":[102,101],"log_dirs":["any","any"]},{"topic":"moving","partition":0,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":4,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":5,"replicas":[102,101],"log_dirs":["any","any"]},{"topic":"moving","partition":1,"replicas":[102,101],"log_dirs":["any","any"]}]}

Save this to use as the --reassignment-json-file option during rollback
Warning: You must run Verify periodically, until the reassignment completes, to ensure the throttle is removed. You can also alter the throttle by rerunning the Execute command passing a new value.
The inter-broker throttle limit was set to 1000000 B/s
Successfully started reassignment of partitions.</pre>
</div>
</div>
</li>
<li>
<p>Observe the new throttling limits configured.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-configs \
    --describe \
    --bootstrap-server kafka-1:19092 \
    --entity-type brokers</strong>
Dynamic configs for broker 101 are:
  leader.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000}
  follower.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000}
Dynamic configs for broker 102 are:
  leader.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000}
  follower.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000}
Dynamic configs for broker 103 are:
  leader.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:leader.replication.throttled.rate=1000000}
  follower.replication.throttled.rate=1000000 sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:follower.replication.throttled.rate=1000000}
Default configs for brokers in the cluster are:</pre>
</div>
</div>
</li>
<li>
<p>Monitor the progress of the reassignment.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Run the <code>kafka-reassign-partitions</code> command with the <code>--verify</code> option and note that some reassignments are âstill in progressâ.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-reassign-partitions \
    --bootstrap-server kafka-1:19092 \
    --reassignment-json-file reassignment.json \
    --verify</strong>

Status of partition reassignment:
Reassignment of partition moving-2 completed successfully
Reassignment of partition moving-3 completed successfully
Reassignment of partition moving-0 is still in progress
Reassignment of partition moving-4 is still in progress
Reassignment of partition moving-5 is still in progress
Reassignment of partition moving-1 is still in progress</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>kafka-topics</code> command with the <code>--describe</code> option and notice the listed replicas for the Partitions that are still in progress for reassignment.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka-1:19092 \
    --describe \
    --topic moving</strong>

Topic:moving	PartitionCount:6	ReplicationFactor:3	Configs:leader.replication.throttled.replicas=0:101,0:102,4:101,4:102,5:102,5:101,1:102,1:101,follower.replication.throttled.replicas=0:103,4:103,5:103,1:103
	Topic: moving	Partition: 0	Leader: 101	Replicas: 102,103,101	Isr: 101,102
	Topic: moving	Partition: 1	Leader: 102	Replicas: 103,101,102	Isr: 102,101
	Topic: moving	Partition: 2	Leader: 101	Replicas: 101,102	Isr: 101,102
	Topic: moving	Partition: 3	Leader: 102	Replicas: 102,101	Isr: 102,101
	Topic: moving	Partition: 4	Leader: 101	Replicas: 103,102,101	Isr: 101,102
	Topic: moving	Partition: 5	Leader: 102	Replicas: 101,103,102	Isr: 102,101</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Increase the throttle limit configuration to 1GBps by rerunning the <code>kafka-reassign-partitions</code> command with the new throttle limit.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-reassign-partitions \
    --bootstrap-server kafka-1:19092 \
    --reassignment-json-file reassignment.json \
    --execute \
    --throttle 1000000000 \
    --additional</strong>
Current partition replica assignment

{"version":1,"partitions":[{"topic":"moving","partition":0,"replicas":[103,101,102],"log_dirs":["any","any","any"]},{"topic":"moving","partition":1,"replicas":[101,102],"log_dirs":["any","any"]},{"topic":"moving","partition":2,"replicas":[102,103,101],"log_dirs":["any","any","any"]},{"topic":"moving","partition":3,"replicas":[103,102,101],"log_dirs":["any","any","any"]},{"topic":"moving","partition":4,"replicas":[101,103,102],"log_dirs":["any","any","any"]},{"topic":"moving","partition":5,"replicas":[102,101],"log_dirs":["any","any"]}]}

Save this to use as the --reassignment-json-file option during rollback
Warning: You must run --verify periodically, until the reassignment completes, to ensure the throttle is removed.
The inter-broker throttle limit was set to 1000000000 B/s</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>kafka-reassign-partitions</code> command with the <code>--verify</code> option again. Note the âcompleted successfullyâ output and âThrottle was removedâ.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-reassign-partitions \
    --bootstrap-server kafka-1:19092 \
    --reassignment-json-file reassignment.json \
    --verify</strong>
Status of partition reassignment:
Reassignment of partition moving-0 is complete.
Reassignment of partition moving-1 is complete.
Reassignment of partition moving-2 is complete.
Reassignment of partition moving-3 is complete.
Reassignment of partition moving-4 is complete.
Reassignment of partition moving-5 is complete.

Clearing broker-level throttles on brokers 101,102,103
Clearing topic-level throttles on topic moving</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the throttle limit is now removed.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-configs \
    --describe \
    --bootstrap-server kafka-1:19092 \
    --entity-type brokers</strong>
Dynamic configs for broker 101 are:
Dynamic configs for broker 102 are:
Dynamic configs for broker 103 are:
Default configs for brokers in the cluster are:</pre>
</div>
</div>
</li>
<li>
<p>Return to (the end of) the exercise <strong>Rebalancing the Cluster</strong> (&#8594; <a href="#simulate-failed-broker">Simulate a Completely Failed Broker</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="docker-local">Appendix B: Running Labs in Docker for Desktop</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have installed Docker for Desktop on your Mac or Windows 10 Pro machine you are able to complete the course by building and running your applications from the command line.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Increase the memory available to Docker Desktop to a minimum of 8 GiB. See the advanced settings for <a href="https://docs.docker.com/docker-for-mac/#advanced">Docker Desktop for Mac</a>, and <a href="https://docs.docker.com/docker-for-windows/#advanced">Docker Desktop for Windows</a>.</p>
</li>
<li>
<p>Follow the instructions at &#8594; <a href="#preparing-lab">Preparing the Labs</a> to <code>git clone</code> the source code, and launch the cluster containers with <code>docker-compose</code>.</p>
</li>
<li>
<p>In each exercise, open a bash shell in the <strong>tools container</strong> to run commands against the cluster. All the command line instructions will work from the <code>tools</code> container. This container has been preconfigured with all of the tools you use in the exercises, e.g. <code>kafka-topics</code>, <code>confluent-rebalancer</code>, and <code>kafka-configs.</code> You can think of this container as a "bastion" inside of your distributed architecture.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>docker-compose exec tools bash</strong>
root@tools:#</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>~/confluent-admin/data</code> folder is mapped to <code>/apps/data</code> in the <code>tools</code> container, so any directions that use <code>~/confluent-admin/data</code> should be executed from <code>/apps/data</code> inside the <code>tools</code> container.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Anywhere you are instructed to open additional terminal windows, you can open additional bash shells on the <code>tools</code> container with the same command as above on your host machine.</p>
</li>
<li>
<p>Any subsequent <code>docker</code> or <code>docker-compose</code> instructions should be run on your host machine.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.0.0-v1.1.0<br>
Last updated 2021-07-20 21:52:34 UTC
</div>
</div>
</body>
</html>